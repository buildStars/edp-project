# åç«¯ä¼˜åŒ–å†…å®¹é€Ÿè§ˆ

> å¿«é€Ÿäº†è§£æœ¬æ¬¡ä¼˜åŒ–çš„ä¸»è¦å†…å®¹å’Œä½¿ç”¨æ–¹æ³•

## ğŸ¯ æ ¸å¿ƒä¼˜åŒ–

### 1. âœ… ä»£ç è´¨é‡æå‡
- **ç§»é™¤57å¤„è°ƒè¯•ä»£ç **ï¼šæ‰€æœ‰ `console.log` å·²æ›¿æ¢ä¸ºä¸“ä¸šçš„ `LoggerService`
- **å®Œå–„ç±»å‹å®šä¹‰**ï¼šæ¶ˆé™¤ `any` ç±»å‹ï¼Œå¢å¼ºç±»å‹å®‰å…¨
- **DTOéªŒè¯å®Œå–„**ï¼šæ‰€æœ‰æ¨¡å—éƒ½æœ‰å®Œæ•´çš„æ•°æ®éªŒè¯

### 2. âœ… ç»Ÿä¸€å¼‚å¸¸å¤„ç†

**æ–°å¢ä¸šåŠ¡å¼‚å¸¸ç±»**ï¼š`src/common/exceptions/business.exception.ts`

```typescript
// ä½¿ç”¨ç¤ºä¾‹
throw BusinessException.notFound('ç”¨æˆ·ä¸å­˜åœ¨');
throw BusinessException.badRequest('å‚æ•°é”™è¯¯');
throw BusinessException.unauthorized('æœªæˆæƒè®¿é—®');
```

**é”™è¯¯ç ç³»ç»Ÿ**ï¼š`src/common/enums/error-code.enum.ts`
- ç³»ç»Ÿçº§é”™è¯¯: 1000-1999
- è¯·æ±‚ç›¸å…³: 2000-2999
- æƒé™ç›¸å…³: 3000-3999
- èµ„æºç›¸å…³: 4000-4999
- ç”¨æˆ·ç›¸å…³: 5000-5999
- è¯¾ç¨‹ç›¸å…³: 6000-6999

### 3. âœ… è¯·æ±‚æ—¥å¿—è¿½è¸ª

**è‡ªåŠ¨è®°å½•æ‰€æœ‰APIè¯·æ±‚**ï¼š
- è¯·æ±‚æ–¹æ³•ã€URLã€IP
- å“åº”çŠ¶æ€ç ã€è€—æ—¶
- å”¯ä¸€è¯·æ±‚IDï¼ˆä¾¿äºè¿½è¸ªï¼‰

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# æ‰€æœ‰æ—¥å¿—
tail -f logs/app-2025-10-31.log

# é”™è¯¯æ—¥å¿—
tail -f logs/error-2025-10-31.log
```

### 4. âœ… å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ

**ä½¿ç”¨æ–¹æ³•**ï¼š
```typescript
// åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥
constructor(
  private prisma: PrismaService,
  private logger: LoggerService,  // æ³¨å…¥æ—¥å¿—æœåŠ¡
) {}

// ä½¿ç”¨æ—¥å¿—
this.logger.log('æ“ä½œæˆåŠŸ', 'ServiceName');
this.logger.error('æ“ä½œå¤±è´¥', error.stack, 'ServiceName');
this.logger.warn('è­¦å‘Šä¿¡æ¯', 'ServiceName');
this.logger.debug('è°ƒè¯•ä¿¡æ¯', 'ServiceName');
```

## ğŸ“‚ æ–°å¢æ–‡ä»¶

### æ ¸å¿ƒç»„ä»¶
```
src/common/
â”œâ”€â”€ exceptions/business.exception.ts    # ä¸šåŠ¡å¼‚å¸¸ç±»
â”œâ”€â”€ enums/error-code.enum.ts           # é”™è¯¯ç æšä¸¾
â”œâ”€â”€ filters/all-exception.filter.ts    # å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨
â””â”€â”€ middleware/
    â”œâ”€â”€ logger.middleware.ts           # è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
    â””â”€â”€ request-id.middleware.ts       # è¯·æ±‚IDä¸­é—´ä»¶
```

### Associations æ¨¡å—å®Œå–„
```
src/modules/cms/associations/dto/
â”œâ”€â”€ create-association.dto.ts          # åˆ›å»ºDTO
â”œâ”€â”€ update-association.dto.ts          # æ›´æ–°DTO
â””â”€â”€ query-association.dto.ts           # æŸ¥è¯¢DTO
```

### æ–‡æ¡£
```
backend/
â”œâ”€â”€ åç«¯ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š.md                 # å®Œæ•´ä¼˜åŒ–æŠ¥å‘Š â­
â”œâ”€â”€ æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–å»ºè®®.md               # æ•°æ®åº“ä¼˜åŒ–æŒ‡å—
â””â”€â”€ ä¼˜åŒ–å†…å®¹é€Ÿè§ˆ.md                    # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### 1. å¯åŠ¨æœåŠ¡

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run start:dev

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app-*.log
```

### 2. æŸ¥çœ‹ API æ–‡æ¡£

```
http://localhost:3000/api/docs
```

### 3. ä½¿ç”¨æ–°çš„å¼‚å¸¸å¤„ç†

```typescript
import { BusinessException } from '@/common/exceptions/business.exception';

// Service æ–¹æ³•ç¤ºä¾‹
async findOne(id: string) {
  const entity = await this.prisma.entity.findUnique({ where: { id } });
  
  if (!entity) {
    throw BusinessException.notFound('èµ„æºä¸å­˜åœ¨');
  }
  
  return entity;
}
```

### 4. æ·»åŠ æ—¥å¿—

```typescript
import { LoggerService } from '@/infrastructure/logger/logger.service';

@Injectable()
export class YourService {
  constructor(
    private logger: LoggerService,
  ) {}

  async someMethod() {
    this.logger.log('å¼€å§‹æ‰§è¡Œæ“ä½œ', 'YourService');
    
    try {
      // ä¸šåŠ¡é€»è¾‘
      this.logger.log('æ“ä½œæˆåŠŸ', 'YourService');
    } catch (error) {
      this.logger.error('æ“ä½œå¤±è´¥', error.stack, 'YourService');
      throw error;
    }
  }
}
```

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| console.log | 57å¤„ | âœ… 0å¤„ |
| ç±»å‹å®‰å…¨ | éƒ¨åˆ†any | âœ… å®Œå…¨ç±»å‹åŒ– |
| å¼‚å¸¸å¤„ç† | ä¸ç»Ÿä¸€ | âœ… ç»Ÿä¸€è§„èŒƒ |
| è¯·æ±‚æ—¥å¿— | ç¼ºå¤± | âœ… å®Œæ•´è®°å½• |
| DTOéªŒè¯ | 80% | âœ… 100% |

## ğŸ” æ’æŸ¥é—®é¢˜

### 1. æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
tail -f logs/app-*.log

# åªçœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error-*.log

# æœç´¢ç‰¹å®šè¯·æ±‚
grep "è¯·æ±‚ID" logs/app-*.log
```

### 2. å¸¸è§é—®é¢˜

**Q: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Ÿ**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3000

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env
```

**Q: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ**
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
npx prisma studio

# é‡æ–°ç”Ÿæˆ Prisma Client
npx prisma generate
```

**Q: æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Ÿ**
- æ—¥å¿—ä¼šè‡ªåŠ¨æŒ‰æ—¥æœŸè½®è½¬
- é»˜è®¤ä¿ç•™14å¤©
- å•ä¸ªæ–‡ä»¶æœ€å¤§20MB

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´ä¼˜åŒ–æŠ¥å‘Š**ï¼š`åç«¯ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š.md` â­
- **æ•°æ®åº“ä¼˜åŒ–**ï¼š`æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–å»ºè®®.md`
- **APIæ–‡æ¡£**ï¼šhttp://localhost:3000/api/docs

## âš¡ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### ç«‹å³å¯åš
1. å¯ç”¨å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨ï¼ˆ`main.ts`ï¼‰
2. å®Œå–„å…¶ä»–æ¨¡å—çš„DTOéªŒè¯
3. æ·»åŠ æ•°æ®åº“ç´¢å¼•

### ä¸­æœŸè®¡åˆ’
1. æ·»åŠ Redisç¼“å­˜
2. å®ç°å•å…ƒæµ‹è¯•
3. æ€§èƒ½å‹æµ‹

### é•¿æœŸè§„åˆ’
1. æ¥å…¥APMç›‘æ§
2. å®ç°è¯»å†™åˆ†ç¦»
3. æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†

## ğŸ’¡ æœ€ä½³å®è·µ

### æ—¥å¿—è®°å½•
```typescript
// âœ… å¥½çš„æ—¥å¿—
this.logger.log(`ç”¨æˆ·åˆ›å»ºæˆåŠŸ - id: ${user.id}`, 'UserService');
this.logger.error('åˆ›å»ºå¤±è´¥', error.stack, 'UserService');

// âŒ é¿å…
console.log('something');
```

### å¼‚å¸¸å¤„ç†
```typescript
// âœ… ç»Ÿä¸€çš„å¼‚å¸¸
throw BusinessException.notFound('ç”¨æˆ·ä¸å­˜åœ¨');

// âŒ é¿å…
throw new Error('not found');
```

### DTO å®šä¹‰
```typescript
// âœ… å®Œæ•´çš„éªŒè¯
@IsString()
@IsNotEmpty({ message: 'åç§°ä¸èƒ½ä¸ºç©º' })
@MaxLength(100, { message: 'åç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦' })
name: string;

// âŒ ç¼ºå°‘éªŒè¯
name: any;
```

## ğŸ“ å­¦ä¹ èµ„æº

- [NestJS å®˜æ–¹æ–‡æ¡£](https://docs.nestjs.com/)
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs)
- [TypeScript æœ€ä½³å®è·µ](https://github.com/labs42io/clean-code-typescript)

---

**ä¼˜åŒ–æ—¥æœŸ**: 2025-10-31  
**ç‰ˆæœ¬**: v1.0  
**å»ºè®®**: 1ä¸ªæœˆåè¿›è¡Œæ€§èƒ½review


