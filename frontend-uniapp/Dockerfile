# ä½¿ç”¨Nginxç›´æ¥éƒ¨ç½²å·²æ„å»ºçš„é™æ€æ–‡ä»¶
# ğŸ“ æ„å»ºå‰å¿…é¡»å…ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼šnpm run build:h5 æˆ–è¿è¡Œ ./build-h5.bat
# ğŸ“ æ„å»ºäº§ç‰©åº”åœ¨ dist/build/h5 æˆ– unpackage/dist/build/h5 ç›®å½•
FROM nginx:alpine

WORKDIR /usr/share/nginx/html

# å¤åˆ¶æœ¬åœ°æ„å»ºäº§ç‰©ï¼ˆæ ¹æ®å®é™…æ„å»ºè¾“å‡ºç›®å½•ä¿®æ”¹ä¸‹é¢çš„è·¯å¾„ï¼‰
# æ–¹å¼1ï¼šå¦‚æœä½¿ç”¨CLIæ„å»ºï¼ˆnpm run build:h5ï¼‰ï¼Œè¾“å‡ºåœ¨ dist/build/h5
# COPY dist/build/h5 ./

# æ–¹å¼2ï¼šå¦‚æœä½¿ç”¨HBuilderXæ„å»ºï¼Œè¾“å‡ºåœ¨ unpackage/dist/build/h5
COPY unpackage/dist/build/h5 ./

# å¤åˆ¶Nginxé…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

# éªŒè¯æ„å»ºäº§ç‰©
RUN test -f "index.html" && echo "âœ… H5æ„å»ºäº§ç‰©å·²å¤åˆ¶" && ls -lh || \
    (echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°index.htmlï¼è¯·å…ˆè¿è¡Œæ„å»ºè„šæœ¬" && exit 1)

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]

