import{u as a,r as e,o as t,c as l,w as o,i as s,d as n,e as c,k as i,t as u,H as r,C as m,a6 as d,D as p,m as f,a7 as v,a8 as _,a9 as g,p as h,q as y,T as k,a2 as b}from"./index-BA-OeFd4.js";import{b as V}from"./util.SBHl27LX.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=w({__name:"edit-info",setup(w){const U=a(),x=e({avatar:"",nickname:"",company:"",position:"",phone:""});t((()=>{const a=U.userInfo||{};x.value={avatar:a.avatar||"/static/images/default-avatar.png",nickname:a.nickname||"",company:a.company||"",position:a.position||"",phone:a.phone||""}}));const j=async a=>{var e;if(console.log("ğŸ“± å¾®ä¿¡æ‰‹æœºå·æˆæƒå›è°ƒ:",a),"getPhoneNumber:ok"===a.detail.errMsg)try{m({title:"ç»‘å®šä¸­..."});const t=await d({code:a.detail.code});console.log("âœ… æ‰‹æœºå·ç»‘å®šæˆåŠŸ:",t),x.value.phone=t.phone||(null==(e=t.data)?void 0:e.phone),await U.fetchUserInfo(),p(),f({title:"æ‰‹æœºå·ç»‘å®šæˆåŠŸ",icon:"success"})}catch(t){console.error("âŒ æ‰‹æœºå·ç»‘å®šå¤±è´¥:",t),p(),f({title:t.message||"ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}else"getPhoneNumber:fail user deny"===a.detail.errMsg?f({title:"æ‚¨å–æ¶ˆäº†æˆæƒ",icon:"none"}):f({title:"è·å–æ‰‹æœºå·å¤±è´¥",icon:"none"})},I=async a=>{console.log("é€‰æ‹©å¾®ä¿¡å¤´åƒ:",a);const e=a.detail.avatarUrl;e&&S(e)},S=async a=>{try{m({title:"ä¸Šä¼ ä¸­..."}),console.log("å¼€å§‹ä¸Šä¼ å¤´åƒ:",a);const e=await v(a);console.log("ä¸Šä¼ ç»“æœ:",e);let t="";t="string"==typeof e?e:e&&"string"==typeof e.url?e.url:e&&"object"==typeof e.data&&"string"==typeof e.data.url?e.data.url:a,x.value.avatar=t,f({title:"ä¸Šä¼ æˆåŠŸ",icon:"success"})}catch(e){console.error("ä¸Šä¼ å¤±è´¥ï¼š",e),f({title:e.msg||"ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}finally{p()}},C=e(!1),M=async()=>{if(!C.value)if(x.value.nickname)try{C.value=!0,m({title:"ä¿å­˜ä¸­..."});const a={avatar:String(x.value.avatar||""),nickname:String(x.value.nickname||""),company:String(x.value.company||""),position:String(x.value.position||"")};console.log("æäº¤æ•°æ®:",a),await _(a),await U.fetchUserInfo(),f({title:"ä¿å­˜æˆåŠŸ",icon:"success"}),setTimeout((()=>{g()}),1500)}catch(a){console.error("ä¿å­˜å¤±è´¥ï¼š",a),f({title:a.msg||"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{C.value=!1,p()}else f({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"})};return(a,e)=>{const t=s,m=h,d=y,p=k,f=b;return n(),l(t,{class:"page"},{default:o((()=>[c(t,{class:"form-item avatar-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("å¤´åƒ")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(p,{class:"avatar-btn","open-type":"chooseAvatar",onChooseavatar:I},{default:o((()=>[c(t,{class:"avatar-wrapper"},{default:o((()=>[c(m,{src:x.value.avatar,class:"avatar-img",mode:"aspectFill"},null,8,["src"]),c(t,{class:"avatar-mask"},{default:o((()=>[c(d,{class:"icon"},{default:o((()=>[i("ğŸ“·")])),_:1})])),_:1})])),_:1})])),_:1}),c(d,{class:"avatar-tip"},{default:o((()=>[i("ç‚¹å‡»æ›´æ¢")])),_:1})])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("æ˜µç§°")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(f,{modelValue:x.value.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value.nickname=a),type:"nickname",placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("å…¬å¸")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(f,{modelValue:x.value.company,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value.company=a),placeholder:"è¯·è¾“å…¥å…¬å¸åç§°"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("èŒä½")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(f,{modelValue:x.value.position,"onUpdate:modelValue":e[2]||(e[2]=a=>x.value.position=a),placeholder:"è¯·è¾“å…¥èŒä½"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("æ‰‹æœºå·")])),_:1}),c(p,{class:"phone-button","open-type":"getPhoneNumber",onGetphonenumber:j},{default:o((()=>[c(t,{class:"item-content"},{default:o((()=>[x.value.phone?(n(),l(d,{key:0,class:"phone-text"},{default:o((()=>[i(u(r(V)(x.value.phone)),1)])),_:1})):(n(),l(d,{key:1,class:"placeholder-text"},{default:o((()=>[i("ç‚¹å‡»æˆæƒç»‘å®šæ‰‹æœºå·")])),_:1})),c(t,{class:"arrow-icon"},{default:o((()=>[c(d,null,{default:o((()=>[i("â€º")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(t,{class:"save-section"},{default:o((()=>[c(p,{class:"save-btn",onClick:M},{default:o((()=>[i("ä¿å­˜")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-508e03c5"]]);export{U as default};
