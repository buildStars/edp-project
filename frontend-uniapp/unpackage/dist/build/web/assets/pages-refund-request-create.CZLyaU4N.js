import{r as e,D as a,G as l,H as t,a3 as s,I as c,Q as u,x as n,c as i,w as o,i as r,d,e as f,k as v,t as _,L as m,A as p,f as h,ae as g,aj as x,y as w,z as y,ak as T,R as I}from"./index-Cljxm-NV.js";import{c as k}from"./refund-request.CBYMOx7x.js";import{f as b}from"./util.DiFpgDCN.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=D({__name:"create",setup(D){const M=e(""),j=e({title:"",coverImage:"",credit:0,startTime:"",enrollmentId:""}),C=e(""),V=e(!1);a((()=>{if(!j.value.startTime)return 0;const e=new Date,a=new Date(j.value.startTime),l=Math.ceil((a-e)/864e5);return Math.max(0,l)}));const A=a((()=>{if(!j.value.startTime)return 0;const e=new Date,a=(new Date(j.value.startTime)-e)/36e5;return Math.max(0,a)})),F=a((()=>A.value<48));l((async e=>{M.value=e.courseId;try{t({title:"加载中..."});const e=await s(M.value);j.value=e,c(),F.value?u({title:"退课提示",content:"当前距离开课不足48小时，退课需要提交管理员审批。请填写退课原因后提交申请。",showCancel:!1,confirmText:"我知道了"}):u({title:"退课提示",content:"退课将扣除5%手续费，无需审批，学分将自动退回。确认要继续吗？",showCancel:!0,cancelText:"取消",confirmText:"继续"})}catch(a){c(),n({title:a.msg||"加载失败",icon:"none"})}}));const L=async()=>{if(F.value&&!C.value.trim())return void n({title:"上课前48小时内退课，请填写退课原因",icon:"none",duration:3e3});const e=F.value?"退课申请将提交管理员审批，审批通过后学分将退回。确认提交吗？":"退课将扣除5%手续费，学分将自动退回。确认退课吗？";u({title:"确认退课",content:e,success:async e=>{if(e.confirm)try{V.value=!0,await k({enrollmentId:j.value.enrollmentId,reason:C.value,needsApproval:F.value,refundFeePercent:F.value?0:5}),V.value=!1;const e=F.value?"退课申请已提交，请等待管理员审批。审批结果将通过消息通知您。":"退课成功！已扣除5%手续费，学分已自动退回。";u({title:"提交成功",content:e,showCancel:!1,success:()=>{g({delta:1,success:()=>{x("refreshCourseDetail")}})}})}catch(a){V.value=!1,n({title:a.msg||"提交失败",icon:"none"})}}})};return(e,a)=>{const l=w,t=y,s=r,c=T,u=I;return d(),i(s,{class:"page"},{default:o((()=>[f(s,{class:"course-card"},{default:o((()=>[f(l,{src:j.value.coverImage,class:"cover",mode:"aspectFill"},null,8,["src"]),f(s,{class:"course-info"},{default:o((()=>[f(t,{class:"title"},{default:o((()=>[v(_(j.value.title),1)])),_:1}),f(s,{class:"info-grid"},{default:o((()=>[f(s,{class:"info-item"},{default:o((()=>[f(t,{class:"label"},{default:o((()=>[v("开课时间")])),_:1}),f(t,{class:"value"},{default:o((()=>[v(_(m(b)(j.value.startTime)),1)])),_:1})])),_:1}),f(s,{class:"info-item"},{default:o((()=>[f(t,{class:"label"},{default:o((()=>[v("退回学分")])),_:1}),f(t,{class:"value highlight"},{default:o((()=>[v(_(j.value.credit),1)])),_:1})])),_:1}),f(s,{class:"info-item"},{default:o((()=>[f(t,{class:"label"},{default:o((()=>[v("距离开课")])),_:1}),f(t,{class:p(["value",{warning:F.value}])},{default:o((()=>[v(_(A.value>=24?Math.floor(A.value/24)+"天":Math.floor(A.value)+"小时"),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1}),f(s,{class:"form-section"},{default:o((()=>[f(s,{class:"section-title"},{default:o((()=>[v(" 退课原因"+_(F.value?"（必填）":"（可选）"),1)])),_:1}),f(c,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:F.value?"上课前48小时内退课需审批，请填写退课原因...":"请填写退课原因，以便我们改进服务...","placeholder-class":"placeholder",maxlength:200},null,8,["modelValue","placeholder"]),f(s,{class:"char-count"},{default:o((()=>[v(_(C.value.length)+"/200",1)])),_:1})])),_:1}),f(s,{class:"tip-section"},{default:o((()=>[f(s,{class:"tip-title"},{default:o((()=>[v("退课说明")])),_:1}),f(s,{class:"tip-item"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("✓")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("退课成功后将退回 "+_(j.value.credit)+" 学分",1)])),_:1})])),_:1}),F.value?(d(),i(s,{key:0,class:"tip-item warning"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("⚠")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("距离开课不足48小时，需要管理员审批")])),_:1})])),_:1})):h("",!0),F.value?(d(),i(s,{key:1,class:"tip-item"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("✓")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("审批通过后学分将全额退回")])),_:1})])),_:1})):h("",!0),F.value?h("",!0):(d(),i(s,{key:2,class:"tip-item"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("✓")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("距离开课超过48小时，无需审批自动退课")])),_:1})])),_:1})),F.value?h("",!0):(d(),i(s,{key:3,class:"tip-item warning"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("⚠")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("将扣除"+_(5)+"%手续费")])),_:1})])),_:1})),f(s,{class:"tip-item"},{default:o((()=>[f(t,{class:"icon"},{default:o((()=>[v("✓")])),_:1}),f(t,{class:"text"},{default:o((()=>[v("学分退回后可用于报名其他课程")])),_:1})])),_:1})])),_:1}),f(s,{class:"footer"},{default:o((()=>[f(u,{class:"btn-submit",onClick:L,loading:V.value},{default:o((()=>[v(" 提交退课申请 ")])),_:1},8,["loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-452ce4b7"]]);export{M as default};
