import{u as e,z as a,r as l,B as s,ag as t,N as c,ah as i,m as u,ad as o,c as r,w as n,i as d,d as f,e as v,k as g,t as p,ai as _,q as m,p as y,T as k}from"./index-CCW0MaS3.js";import{c as x}from"./course-gift.BHW34qfO.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=b({__name:"claim",setup(b){const z=e(),h=a((()=>!!z.token)),w=l(!0),C=l(!1),j=l(!1),L=l(""),T=l(null),$=l("");s((async e=>{const a=e.code;if(!a)return $.value="礼物码无效",void(w.value=!1);if(L.value=a,!h.value){return t("redirectAfterLogin",`/pages/course-gift/claim?code=${a}`),c({title:"提示",content:"请先登录后领取课程",confirmText:"去登录",success:e=>{e.confirm?i({url:"/pages/login/index"}):i({url:"/pages/index/index"})}}),void(w.value=!1)}await A()}));const A=async()=>{try{w.value=!0;const e=await x({giftCode:L.value});e.course&&(T.value=e.course,j.value=!0,u({title:"领取成功！",icon:"success"}))}catch(e){e.msg&&e.msg.includes("已报名")?($.value="您已经拥有这门课程了",j.value=!0):$.value=e.msg||"礼物码无效或已被领取"}finally{w.value=!1}},I=async()=>{if(!h.value){const e=`/pages/course-gift/claim?code=${L.value}`;return t("redirectAfterLogin",e),void i({url:"/pages/login/index"})}await A()},q=()=>{T.value&&_({url:`/pages/course/detail?id=${T.value.id}`})},B=()=>{i({url:"/pages/index/index"})};return(e,a)=>{const l=o("uni-icons"),s=m,t=d,c=y,i=k;return f(),r(t,{class:"page"},{default:n((()=>[w.value?(f(),r(t,{key:0,class:"loading-container"},{default:n((()=>[v(l,{type:"spinner-cycle",size:"60",color:"#2979ff",class:"loading-icon"}),v(s,{class:"loading-text"},{default:n((()=>[g("正在加载...")])),_:1})])),_:1})):T.value?(f(),r(t,{key:1,class:"content"},{default:n((()=>[v(t,{class:"gift-card"},{default:n((()=>[v(c,{src:T.value.coverImage,class:"course-cover",mode:"aspectFill"},null,8,["src"]),v(t,{class:"gift-icon"},{default:n((()=>[v(l,{type:"gift",size:"80",color:"#ff6b6b"})])),_:1}),v(t,{class:"course-title"},{default:n((()=>[g(p(T.value.title),1)])),_:1}),v(t,{class:"credit-info"},{default:n((()=>[v(s,{class:"credit-label"},{default:n((()=>[g("课程价值")])),_:1}),v(s,{class:"credit-value"},{default:n((()=>[g(p(T.value.credit)+" 学分",1)])),_:1})])),_:1}),v(t,{class:"gift-message"},{default:n((()=>[g(" 好友向你赠送了这门课程 ")])),_:1}),j.value?(f(),r(t,{key:1,class:"claimed-tip"},{default:n((()=>[v(l,{type:"checkmarkempty",size:"30",color:"#4caf50"}),v(s,null,{default:n((()=>[g("已领取")])),_:1})])),_:1})):(f(),r(i,{key:0,class:"claim-btn",onClick:I,disabled:C.value},{default:n((()=>[C.value?(f(),r(s,{key:1},{default:n((()=>[g("领取中...")])),_:1})):(f(),r(s,{key:0},{default:n((()=>[g(p(h.value?"立即领取":"登录后领取"),1)])),_:1}))])),_:1},8,["disabled"]))])),_:1}),v(i,{class:"detail-btn",onClick:q},{default:n((()=>[g(" 查看课程详情 ")])),_:1})])),_:1})):(f(),r(t,{key:2,class:"error-container"},{default:n((()=>[v(l,{type:"closeempty",size:"80",color:"#999"}),v(s,{class:"error-text"},{default:n((()=>[g(p($.value),1)])),_:1}),v(i,{class:"back-btn",onClick:B},{default:n((()=>[g(" 返回首页 ")])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-ba9a97c9"]]);export{z as default};
