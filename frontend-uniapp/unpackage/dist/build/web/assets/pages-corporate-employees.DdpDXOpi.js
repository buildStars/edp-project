import{r as a,B as e,m as l,an as s,c as t,w as c,i as o,d as u,e as n,k as i,t as d,h as r,j as p,F as f,f as m,R as _,C as v,D as y,q as k,T as b,a2 as h,l as C}from"./index-BA-OeFd4.js";import{g,a as w}from"./corporate.CrD6A_s2.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=B({__name:"employees",setup(B){const I=a([]),j=a(!1),x=a(0),N=a(!1),U=a(null),V=a("");e((async()=>{await $(),await R()}));const $=async()=>{j.value=!0;try{const a=await g();I.value=a}catch(a){l({title:a.message||"加载失败",icon:"none"})}finally{j.value=!1}},R=async()=>{try{const a=await s();x.value=a.balance||0}catch(a){console.error("加载学分失败:",a)}},q=async()=>{const a=parseInt(V.value);if(!a||a<=0)l({title:"请输入有效的学分数量",icon:"none"});else if(a>x.value)l({title:"您的个人学分不足",icon:"none"});else try{v({title:"分配中..."}),await w({toUserId:U.value.id,amount:a}),y(),l({title:"分配成功",icon:"success"}),D(),await $(),await R()}catch(e){y(),l({title:e.message||"分配失败",icon:"none"})}},D=()=>{N.value=!1,U.value=null,V.value=""};return(a,e)=>{const l=o,s=k,v=b,y=h;return u(),t(l,{class:"page-container"},{default:c((()=>[n(l,{class:"stat-card"},{default:c((()=>[n(l,{class:"stat-title"},{default:c((()=>[i("企业员工管理")])),_:1}),n(l,{class:"stat-info"},{default:c((()=>[n(s,{class:"stat-label"},{default:c((()=>[i("员工总数：")])),_:1}),n(s,{class:"stat-value"},{default:c((()=>[i(d(I.value.length),1)])),_:1})])),_:1})])),_:1}),n(l,{class:"employee-list"},{default:c((()=>[(u(!0),r(f,null,p(I.value,(a=>(u(),t(l,{key:a.id,class:"employee-card",onClick:e=>(a=>{C({url:`/pages/corporate/employee-detail?id=${a.id}`})})(a)},{default:c((()=>[n(l,{class:"employee-info"},{default:c((()=>[n(l,{class:"employee-header"},{default:c((()=>[n(s,{class:"employee-name"},{default:c((()=>[i(d(a.realName||a.nickname),1)])),_:2},1024),a.position?(u(),t(s,{key:0,class:"employee-position"},{default:c((()=>[i(d(a.position),1)])),_:2},1024)):m("",!0)])),_:2},1024),n(l,{class:"employee-phone"},{default:c((()=>[i(d(a.phone),1)])),_:2},1024)])),_:2},1024),n(l,{class:"credit-info"},{default:c((()=>[n(l,{class:"credit-item"},{default:c((()=>[n(s,{class:"credit-label"},{default:c((()=>[i("个人学分")])),_:1}),n(s,{class:"credit-value personal"},{default:c((()=>[i(d(a.personalBalance),1)])),_:2},1024)])),_:2},1024),n(l,{class:"credit-item"},{default:c((()=>[n(s,{class:"credit-label"},{default:c((()=>[i("企业学分")])),_:1}),n(s,{class:"credit-value corporate"},{default:c((()=>[i(d(a.corporateBalance),1)])),_:2},1024)])),_:2},1024),n(l,{class:"credit-item total"},{default:c((()=>[n(s,{class:"credit-label"},{default:c((()=>[i("总学分")])),_:1}),n(s,{class:"credit-value"},{default:c((()=>[i(d(a.totalBalance),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(l,{class:"action-btns"},{default:c((()=>[n(v,{class:"btn-small btn-primary",onClick:_((e=>(a=>{U.value=a,V.value="",N.value=!0})(a)),["stop"])},{default:c((()=>[i(" 分配学分 ")])),_:2},1032,["onClick"]),n(v,{class:"btn-small btn-success",onClick:_((e=>(a=>{C({url:`/pages/corporate/purchase-course?employeeId=${a.id}&employeeName=${encodeURIComponent(a.realName||a.nickname)}`})})(a)),["stop"])},{default:c((()=>[i(" 购买课程 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128)),j.value||0!==I.value.length?m("",!0):(u(),t(l,{key:0,class:"empty-state"},{default:c((()=>[n(s,{class:"empty-text"},{default:c((()=>[i("暂无企业员工")])),_:1})])),_:1}))])),_:1}),N.value?(u(),t(l,{key:0,class:"popup-mask",onClick:D},{default:c((()=>[n(l,{class:"popup-content",onClick:e[1]||(e[1]=_((()=>{}),["stop"]))},{default:c((()=>[n(l,{class:"popup-header"},{default:c((()=>[n(s,{class:"popup-title"},{default:c((()=>[i("分配学分")])),_:1}),n(s,{class:"popup-close",onClick:D},{default:c((()=>[i("×")])),_:1})])),_:1}),n(l,{class:"popup-body"},{default:c((()=>[n(l,{class:"form-item"},{default:c((()=>[n(s,{class:"form-label"},{default:c((()=>[i("员工姓名")])),_:1}),n(s,{class:"form-value"},{default:c((()=>{var a,e;return[i(d((null==(a=U.value)?void 0:a.realName)||(null==(e=U.value)?void 0:e.nickname)),1)]})),_:1})])),_:1}),n(l,{class:"form-item"},{default:c((()=>[n(s,{class:"form-label"},{default:c((()=>[i("当前企业学分")])),_:1}),n(s,{class:"form-value"},{default:c((()=>{var a;return[i(d(null==(a=U.value)?void 0:a.corporateBalance),1)]})),_:1})])),_:1}),n(l,{class:"form-item"},{default:c((()=>[n(s,{class:"form-label"},{default:c((()=>[i("分配数量")])),_:1}),n(y,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),class:"form-input",type:"number",placeholder:"请输入学分数量"},null,8,["modelValue"])])),_:1}),n(l,{class:"form-tip"},{default:c((()=>[i(" 您的个人学分余额："+d(x.value),1)])),_:1})])),_:1}),n(l,{class:"popup-footer"},{default:c((()=>[n(v,{class:"btn-cancel",onClick:D},{default:c((()=>[i("取消")])),_:1}),n(v,{class:"btn-confirm",onClick:q},{default:c((()=>[i("确认分配")])),_:1})])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})}}},[["__scopeId","data-v-60e86b46"]]);export{I as default};
