import{C as e,r as s,D as t,o as a,x as l,s as r,b as i,E as n,c as o,w as u,i as c,d as h,e as g,h as v,j as p,F as w,f as y,k as d,z as f,A as _,t as m,l as C}from"./index-Cljxm-NV.js";import{g as L}from"./news.DJfprz8c.js";import{N as k}from"./news-card.DZUxF8n8.js";import{E as b}from"./empty-view.C6sbClhI.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./util.DiFpgDCN.js";/* empty css                                                                   */const x=e("news",{state:()=>({currentCategory:"",newsList:[],page:1,pageSize:10,total:0,hasMore:!0}),getters:{currentNewsList:e=>e.currentCategory?e.newsList.filter((s=>s.category===e.currentCategory)):e.newsList},actions:{setCurrentCategory(e){this.currentCategory=e,this.clearNewsList()},async fetchNewsList(e=!1){try{e&&(this.page=1,this.hasMore=!0);const s={page:this.page,pageSize:this.pageSize};this.currentCategory&&(s.category=this.currentCategory);const t=await L(s),a=t.items||t.data||t.list||[];return this.newsList=e?a:[...this.newsList,...a],this.total=t.total||0,this.page++,this.hasMore=this.newsList.length<this.total,t}catch(s){throw console.error("获取资讯列表失败：",s),s}},clearNewsList(){this.newsList=[],this.page=1,this.hasMore=!0}}}),M=j({__name:"index",setup(e){const L=s([{label:"全部",value:""},{label:"官方动态",value:"official"},{label:"校友故事",value:"alumni"}]),j=s(""),M=s(!1),N=x(),z=t((()=>N.newsList)),S=t((()=>N.hasMore));a((()=>{D(!0)}));const D=async(e=!1)=>{if(!M.value){M.value=!0;try{await N.fetchNewsList(e)}catch(s){console.error("加载资讯失败：",s),l({title:"加载失败",icon:"none"})}finally{M.value=!1,e&&r()}}},E=()=>{D(!0)},F=e=>{C({url:`/pages/news/detail?id=${e.id}`})};return i((()=>{E()})),n((()=>{S.value&&!M.value&&D(!1)})),(e,s)=>{const t=c,a=f;return h(),o(t,{class:"page"},{default:u((()=>[g(t,{class:"category-tabs"},{default:u((()=>[(h(!0),v(w,null,p(L.value,((e,s)=>(h(),o(t,{key:s,class:_(["tab-item",{active:j.value===e.value}]),onClick:s=>{return t=e.value,void(j.value!==t&&(j.value=t,N.setCurrentCategory(t),D(!0)));var t}},{default:u((()=>[d(m(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),g(t,{class:"news-list"},{default:u((()=>[(h(!0),v(w,null,p(z.value,((e,s)=>(h(),o(k,{key:e.id,news:e,onClick:F},null,8,["news"])))),128)),M.value||0!==z.value.length?y("",!0):(h(),o(b,{key:0,text:"暂无资讯","show-btn":!0,onClick:E})),M.value?(h(),o(t,{key:1,class:"loading-more"},{default:u((()=>[g(a,null,{default:u((()=>[d("加载中...")])),_:1})])),_:1})):y("",!0),!S.value&&z.value.length>0?(h(),o(t,{key:2,class:"no-more"},{default:u((()=>[g(a,null,{default:u((()=>[d("没有更多了")])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-b368c851"]]);export{M as default};
