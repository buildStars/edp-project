import{u as a,r as e,D as l,G as s,H as t,a3 as c,I as u,x as d,c as i,w as o,i as n,d as r,e as f,k as _,t as v,L as m,A as p,Q as b,ae as g,aj as h,y as x,z as I,a8 as w,ak as y,R as C}from"./index-Cljxm-NV.js";import{a as V}from"./course-gift.CMB_jCIL.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=j({__name:"create",setup(j){const D=a(),k=e(""),U=e({title:"",coverImage:"",credit:0}),L=e(""),R=e(""),$=e(!1),q=l((()=>D.remainingCredits-(U.value.credit||0))),z=l((()=>L.value&&q.value>=0));s((async a=>{k.value=a.courseId;try{t({title:"加载中..."});const a=await c(k.value);U.value=a,await D.fetchCredits(),u()}catch(e){u(),d({title:e.msg||"加载失败",icon:"none"})}}));const A=async()=>{L.value?q.value<0?d({title:"学分不足",icon:"none"}):b({title:"确认赠送",content:`将消耗 ${U.value.credit} 学分赠送课程《${U.value.title}》给对方，确认吗？`,success:async a=>{if(a.confirm)try{$.value=!0,await V({courseId:k.value,toUser:L.value,message:R.value}),$.value=!1,b({title:"赠送成功",content:"课程已成功赠送给对方，对方将收到通知。",showCancel:!1,success:()=>{g({delta:1,success:()=>{h("refreshCourseDetail")}})}})}catch(e){$.value=!1,d({title:e.msg||"赠送失败",icon:"none"})}}}):d({title:"请输入接收方",icon:"none"})};return(a,e)=>{const l=x,s=I,t=n,c=w,u=y,d=C;return r(),i(t,{class:"page"},{default:o((()=>[f(t,{class:"course-card"},{default:o((()=>[f(l,{src:U.value.coverImage,class:"cover",mode:"aspectFill"},null,8,["src"]),f(t,{class:"course-info"},{default:o((()=>[f(s,{class:"title"},{default:o((()=>[_(v(U.value.title),1)])),_:1}),f(t,{class:"credit-badge"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("消耗学分")])),_:1}),f(s,{class:"value"},{default:o((()=>[_(v(U.value.credit),1)])),_:1})])),_:1})])),_:1})])),_:1}),f(t,{class:"form-section"},{default:o((()=>[f(t,{class:"section-title"},{default:o((()=>[_("赠送信息")])),_:1}),f(t,{class:"form-item required"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("接收方")])),_:1}),f(c,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"请输入对方的手机号或用户ID","placeholder-class":"placeholder"},null,8,["modelValue"]),f(s,{class:"tip"},{default:o((()=>[_("可输入手机号或用户ID")])),_:1})])),_:1}),f(t,{class:"form-item"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("赠送留言")])),_:1}),f(u,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=a=>R.value=a),placeholder:"给对方留言（可选）","placeholder-class":"placeholder",maxlength:100},null,8,["modelValue"]),f(t,{class:"char-count"},{default:o((()=>[_(v(R.value.length)+"/100",1)])),_:1})])),_:1})])),_:1}),f(t,{class:"balance-section"},{default:o((()=>[f(t,{class:"balance-item current"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("当前学分")])),_:1}),f(s,{class:"value"},{default:o((()=>[_(v(m(D).remainingCredits),1)])),_:1})])),_:1}),f(t,{class:"balance-arrow"},{default:o((()=>[_("→")])),_:1}),f(t,{class:"balance-item after"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("赠送后剩余")])),_:1}),f(s,{class:p(["value",{insufficient:q.value<0}])},{default:o((()=>[_(v(q.value),1)])),_:1},8,["class"])])),_:1})])),_:1}),f(t,{class:"tip-section"},{default:o((()=>[f(t,{class:"tip-title"},{default:o((()=>[_("赠送说明")])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("赠送后立即生效，对方将自动报名该课程")])),_:1})])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_('赠送记录可在"个人中心-赠送记录"中查看')])),_:1})])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("老师可查看赠送记录，了解课程来源")])),_:1})])),_:1}),f(t,{class:"tip-item warning"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("!")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("赠送的课程对方不能退课")])),_:1})])),_:1})])),_:1}),f(t,{class:"footer"},{default:o((()=>[f(d,{class:"btn-submit",onClick:A,disabled:!z.value,loading:$.value},{default:o((()=>[_(" 确认赠送 ")])),_:1},8,["disabled","loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-90ceb5ab"]]);export{D as default};
