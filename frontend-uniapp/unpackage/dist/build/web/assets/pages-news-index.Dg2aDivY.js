import{y as e,r as s,z as t,o as a,g as l,m as i,s as r,b as n,A as o,c as u,w as c,i as h,d as v,e as g,n as p,h as _,j as y,F as m,f as w,k as d,q as f,v as C,t as L,l as j}from"./index-BA-OeFd4.js";import{g as b}from"./news.DNtdDH2m.js";import{C as k}from"./custom-navbar.CczeCHJz.js";import{N as x}from"./news-card.CHXG1YTM.js";import{E as M}from"./empty-view.BTAzOfaH.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./icon.DZSIreks.js";/* empty css                                                                      */import"./util.SBHl27LX.js";/* empty css                                                                   */const z=e("news",{state:()=>({currentCategory:"",newsList:[],page:1,pageSize:10,total:0,hasMore:!0}),getters:{currentNewsList:e=>e.currentCategory?e.newsList.filter((s=>s.category===e.currentCategory)):e.newsList},actions:{setCurrentCategory(e){this.currentCategory=e,this.clearNewsList()},async fetchNewsList(e=!1){try{e&&(this.page=1,this.hasMore=!0);const s={page:this.page,pageSize:this.pageSize};this.currentCategory&&(s.category=this.currentCategory);const t=await b(s),a=t.items||t.data||t.list||[];return this.newsList=e?a:[...this.newsList,...a],this.total=t.total||0,this.page++,this.hasMore=this.newsList.length<this.total,t}catch(s){throw console.error("获取资讯列表失败：",s),s}},clearNewsList(){this.newsList=[],this.page=1,this.hasMore=!0}}}),S=N({__name:"index",setup(e){const b=s(0),N=s([{label:"全部",value:""},{label:"官方动态",value:"official"},{label:"校友故事",value:"alumni"}]),S=s(""),F=s(!1),H=z(),q=t((()=>H.newsList)),A=t((()=>H.hasMore));a((()=>{const e=l();b.value=(e.statusBarHeight||0)+44,B(!0)}));const B=async(e=!1)=>{if(!F.value){F.value=!0;try{await H.fetchNewsList(e)}catch(s){console.error("加载资讯失败：",s),i({title:"加载失败",icon:"none"})}finally{F.value=!1,e&&r()}}},D=()=>{B(!0)},E=e=>{j({url:`/pages/news/detail?id=${e.id}`})};return n((()=>{D()})),o((()=>{A.value&&!F.value&&B(!1)})),(e,s)=>{const t=h,a=f;return v(),u(t,{class:"page"},{default:c((()=>[g(k,{title:"学校资讯"}),g(t,{style:p({height:b.value+"px"})},null,8,["style"]),g(t,{class:"category-tabs"},{default:c((()=>[(v(!0),_(m,null,y(N.value,((e,s)=>(v(),u(t,{key:s,class:C(["tab-item",{active:S.value===e.value}]),onClick:s=>{return t=e.value,void(S.value!==t&&(S.value=t,H.setCurrentCategory(t),B(!0)));var t}},{default:c((()=>[d(L(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),g(t,{class:"news-list"},{default:c((()=>[(v(!0),_(m,null,y(q.value,((e,s)=>(v(),u(x,{key:e.id,news:e,onClick:E},null,8,["news"])))),128)),F.value||0!==q.value.length?w("",!0):(v(),u(M,{key:0,text:"暂无资讯","show-btn":!0,onClick:D})),F.value?(v(),u(t,{key:1,class:"loading-more"},{default:c((()=>[g(a,null,{default:c((()=>[d("加载中...")])),_:1})])),_:1})):w("",!0),!A.value&&q.value.length>0?(v(),u(t,{key:2,class:"no-more"},{default:c((()=>[g(a,null,{default:c((()=>[d("没有更多了")])),_:1})])),_:1})):w("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-e84a46c2"]]);export{S as default};
