import{r as a,B as e,a as s,m as t,an as l,c,w as o,i as u,d as r,e as i,k as n,t as d,h as m,j as p,F as f,f as _,q as y,p as v,H as g,v as h,R as k,l as w,N as I,C as j,D as C,a9 as S,T as $}from"./index-CCW0MaS3.js";import{_ as x}from"./empty.Dy77HuBL.js";import{p as N}from"./corporate.BuDpyXGB.js";import{f as b}from"./util.BUrGU9NL.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=E({__name:"purchase-course",setup(E){const F=a(""),P=a(""),T=a([]),U=a(!1),B=a(0);e((async a=>{F.value=a.employeeId,P.value=decodeURIComponent(a.employeeName||""),await D(),await H()}));const D=async()=>{U.value=!0;try{const a=await s({status:"PUBLISHED",page:1,pageSize:100});T.value=a.items||[]}catch(a){t({title:a.message||"加载失败",icon:"none"})}finally{U.value=!1}},H=async()=>{try{const a=await l();B.value=a.balance||0}catch(a){console.error("加载学分失败:",a)}};return(a,e)=>{const s=y,l=u,E=v,D=$;return r(),c(l,{class:"page-container"},{default:o((()=>[i(l,{class:"employee-info-card"},{default:o((()=>[i(s,{class:"label"},{default:o((()=>[n("为以下员工购买课程：")])),_:1}),i(s,{class:"employee-name"},{default:o((()=>[n(d(P.value),1)])),_:1})])),_:1}),i(l,{class:"course-list"},{default:o((()=>[(r(!0),m(f,null,p(T.value,(a=>(r(),c(l,{key:a.id,class:"course-card",onClick:e=>(a=>{w({url:`/pages/course/detail?id=${a.id}`})})(a)},{default:o((()=>[i(E,{src:a.coverImage,class:"course-cover",mode:"aspectFill"},null,8,["src"]),i(l,{class:"course-info"},{default:o((()=>[i(s,{class:"course-title"},{default:o((()=>[n(d(a.title),1)])),_:2},1024),i(l,{class:"course-meta"},{default:o((()=>[i(s,{class:"course-time"},{default:o((()=>[n(d(g(b)(a.startTime)),1)])),_:2},1024),i(s,{class:"course-credit"},{default:o((()=>[n(d(a.credit)+"学分",1)])),_:2},1024)])),_:2},1024),i(l,{class:"course-status"},{default:o((()=>[i(s,{class:h(["status-tag",a.enrollStatus])},{default:o((()=>[n(d("OPEN"===a.enrollStatus?"报名中":"已截止"),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),i(D,{class:"btn-purchase",onClick:k((e=>(async a=>{"OPEN"===a.enrollStatus?B.value<a.credit?t({title:`您的个人学分不足（需要${a.credit}学分）`,icon:"none"}):I({title:"确认购买",content:`确定为 ${P.value} 购买课程《${a.title}》吗？将消耗您的 ${a.credit} 个人学分。`,success:async e=>{if(e.confirm)try{j({title:"购买中..."}),await N({toUserId:F.value,courseId:a.id}),C(),t({title:"购买成功",icon:"success"}),await H(),setTimeout((()=>{S()}),1500)}catch(s){C(),t({title:s.message||"购买失败",icon:"none"})}}}):t({title:"该课程报名已截止",icon:"none"})})(a)),["stop"])},{default:o((()=>[n(" 立即购买 ")])),_:2},1032,["onClick"])])),_:2},1032,["onClick"])))),128)),U.value||0!==T.value.length?_("",!0):(r(),c(l,{key:0,class:"empty-state"},{default:o((()=>[i(E,{src:x,class:"empty-image",mode:"aspectFit"}),i(s,{class:"empty-text"},{default:o((()=>[n("暂无可购买的课程")])),_:1})])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-99379ce8"]]);export{F as default};
