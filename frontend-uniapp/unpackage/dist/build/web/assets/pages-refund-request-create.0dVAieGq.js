import{r as e,z as a,B as l,C as s,X as t,D as c,N as u,a9 as i,m as o,c as n,w as d,i as r,d as f,e as _,k as m,t as v,H as p,ae as h,p as g,q as x,af as w,T as I}from"./index-CCW0MaS3.js";import{c as b}from"./refund-request.nUsv9NKh.js";import{f as C}from"./util.BUrGU9NL.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=T({__name:"create",setup(T){const j=e(""),y=e({title:"",coverImage:"",credit:0,startTime:"",enrollmentId:""}),D=e(""),M=e(!1),V=a((()=>{if(!y.value.startTime)return 0;const e=new Date,a=new Date(y.value.startTime),l=Math.ceil((a-e)/864e5);return Math.max(0,l)}));l((async e=>{j.value=e.courseId;try{s({title:"加载中..."});const e=await t(j.value);y.value=e,c(),V.value<=3&&u({title:"不能退课",content:`开课前3天内不能退课，当前距离开课还有${V.value}天`,showCancel:!1,success:()=>{i()}})}catch(a){c(),o({title:a.msg||"加载失败",icon:"none"})}}));const k=async()=>{if(V.value<=3)o({title:`开课前3天内不能退课，当前距离开课还有${V.value}天`,icon:"none",duration:3e3});else try{M.value=!0,await b({enrollmentId:y.value.enrollmentId,reason:D.value}),M.value=!1,u({title:"提交成功",content:"退课申请已提交，请等待管理员审批。审批结果将通过消息通知您。",showCancel:!1,success:()=>{i({delta:1,success:()=>{h("refreshCourseDetail")}})}})}catch(e){M.value=!1,o({title:e.msg||"提交失败",icon:"none"})}};return(e,a)=>{const l=g,s=x,t=r,c=w,u=I;return f(),n(t,{class:"page"},{default:d((()=>[_(t,{class:"course-card"},{default:d((()=>[_(l,{src:y.value.coverImage,class:"cover",mode:"aspectFill"},null,8,["src"]),_(t,{class:"course-info"},{default:d((()=>[_(s,{class:"title"},{default:d((()=>[m(v(y.value.title),1)])),_:1}),_(t,{class:"info-grid"},{default:d((()=>[_(t,{class:"info-item"},{default:d((()=>[_(s,{class:"label"},{default:d((()=>[m("开课时间")])),_:1}),_(s,{class:"value"},{default:d((()=>[m(v(p(C)(y.value.startTime)),1)])),_:1})])),_:1}),_(t,{class:"info-item"},{default:d((()=>[_(s,{class:"label"},{default:d((()=>[m("退回学分")])),_:1}),_(s,{class:"value highlight"},{default:d((()=>[m(v(y.value.credit),1)])),_:1})])),_:1}),_(t,{class:"info-item"},{default:d((()=>[_(s,{class:"label"},{default:d((()=>[m("剩余天数")])),_:1}),_(s,{class:"value"},{default:d((()=>[m(v(V.value)+"天",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),_(t,{class:"form-section"},{default:d((()=>[_(t,{class:"section-title"},{default:d((()=>[m("退课原因（可选）")])),_:1}),_(c,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),placeholder:"请填写退课原因，以便我们改进服务...","placeholder-class":"placeholder",maxlength:200},null,8,["modelValue"]),_(t,{class:"char-count"},{default:d((()=>[m(v(D.value.length)+"/200",1)])),_:1})])),_:1}),_(t,{class:"tip-section"},{default:d((()=>[_(t,{class:"tip-title"},{default:d((()=>[m("退课说明")])),_:1}),_(t,{class:"tip-item"},{default:d((()=>[_(s,{class:"icon"},{default:d((()=>[m("✓")])),_:1}),_(s,{class:"text"},{default:d((()=>[m("退课成功后将退回 "+v(y.value.credit)+" 学分",1)])),_:1})])),_:1}),_(t,{class:"tip-item"},{default:d((()=>[_(s,{class:"icon"},{default:d((()=>[m("✓")])),_:1}),_(s,{class:"text"},{default:d((()=>[m("提交后需等待管理员审批")])),_:1})])),_:1}),_(t,{class:"tip-item"},{default:d((()=>[_(s,{class:"icon"},{default:d((()=>[m("✓")])),_:1}),_(s,{class:"text"},{default:d((()=>[m("审批通过后学分将自动退回")])),_:1})])),_:1}),_(t,{class:"tip-item warning"},{default:d((()=>[_(s,{class:"icon"},{default:d((()=>[m("!")])),_:1}),_(s,{class:"text"},{default:d((()=>[m("开课前3天内不可退课")])),_:1})])),_:1})])),_:1}),_(t,{class:"footer"},{default:d((()=>[_(u,{class:"btn-submit",onClick:k,loading:M.value},{default:d((()=>[m(" 提交退课申请 ")])),_:1},8,["loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-e870ce10"]]);export{j as default};
