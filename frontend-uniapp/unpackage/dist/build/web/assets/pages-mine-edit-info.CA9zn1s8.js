import{u as a,r as e,o as t,c as l,w as o,i as s,d as n,e as c,k as i,t as u,L as r,H as d,ab as m,I as f,x as p,ac as v,ad as _,ae as y,y as g,z as h,R as b,a8 as k}from"./index-Cljxm-NV.js";import{b as V}from"./util.DiFpgDCN.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=w({__name:"edit-info",setup(w){const x=a(),U=e({avatar:"",nickname:"",company:"",position:"",phone:""});t((()=>{const a=x.userInfo||{};U.value={avatar:a.avatar||"/static/images/default-avatar.png",nickname:a.nickname||"",company:a.company||"",position:a.position||"",phone:a.phone||""}}));const I=async a=>{var e;if(console.log("ğŸ“± å¾®ä¿¡æ‰‹æœºå·æˆæƒå›è°ƒ:",a),"getPhoneNumber:ok"===a.detail.errMsg)try{d({title:"ç»‘å®šä¸­..."});const t=await m({code:a.detail.code});console.log("âœ… æ‰‹æœºå·ç»‘å®šæˆåŠŸ:",t),U.value.phone=t.phone||(null==(e=t.data)?void 0:e.phone),await x.fetchUserInfo(),f(),p({title:"æ‰‹æœºå·ç»‘å®šæˆåŠŸ",icon:"success"})}catch(t){console.error("âŒ æ‰‹æœºå·ç»‘å®šå¤±è´¥:",t),f(),p({title:t.message||"ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}else"getPhoneNumber:fail user deny"===a.detail.errMsg?p({title:"æ‚¨å–æ¶ˆäº†æˆæƒ",icon:"none"}):p({title:"è·å–æ‰‹æœºå·å¤±è´¥",icon:"none"})},j=async a=>{console.log("é€‰æ‹©å¾®ä¿¡å¤´åƒ:",a);const e=a.detail.avatarUrl;e&&S(e)},S=async a=>{try{d({title:"ä¸Šä¼ ä¸­..."}),console.log("å¼€å§‹ä¸Šä¼ å¤´åƒ:",a);const e=await v(a);console.log("ä¸Šä¼ ç»“æœ:",e);let t="";t="string"==typeof e?e:e&&"string"==typeof e.url?e.url:e&&"object"==typeof e.data&&"string"==typeof e.data.url?e.data.url:a,U.value.avatar=t,p({title:"ä¸Šä¼ æˆåŠŸ",icon:"success"})}catch(e){console.error("ä¸Šä¼ å¤±è´¥ï¼š",e),p({title:e.msg||"ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}finally{f()}},M=e(!1),N=async()=>{if(!M.value)if(U.value.nickname)try{M.value=!0,d({title:"ä¿å­˜ä¸­..."});const a={avatar:String(U.value.avatar||""),nickname:String(U.value.nickname||""),company:String(U.value.company||""),position:String(U.value.position||"")};console.log("æäº¤æ•°æ®:",a),await _(a),await x.fetchUserInfo(),p({title:"ä¿å­˜æˆåŠŸ",icon:"success"}),setTimeout((()=>{y()}),1500)}catch(a){console.error("ä¿å­˜å¤±è´¥ï¼š",a),p({title:a.msg||"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{M.value=!1,f()}else p({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"})};return(a,e)=>{const t=s,d=g,m=h,f=b,p=k;return n(),l(t,{class:"page"},{default:o((()=>[c(t,{class:"form-item avatar-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("å¤´åƒ")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(f,{class:"avatar-btn","open-type":"chooseAvatar",onChooseavatar:j},{default:o((()=>[c(t,{class:"avatar-wrapper"},{default:o((()=>[c(d,{src:U.value.avatar,class:"avatar-img",mode:"aspectFill"},null,8,["src"]),c(t,{class:"avatar-mask"},{default:o((()=>[c(m,{class:"icon"},{default:o((()=>[i("ğŸ“·")])),_:1})])),_:1})])),_:1})])),_:1}),c(m,{class:"avatar-tip"},{default:o((()=>[i("ç‚¹å‡»æ›´æ¢")])),_:1})])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("æ˜µç§°")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(p,{modelValue:U.value.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value.nickname=a),type:"nickname",placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("å…¬å¸")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(p,{modelValue:U.value.company,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value.company=a),placeholder:"è¯·è¾“å…¥å…¬å¸åç§°"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("èŒä½")])),_:1}),c(t,{class:"item-content"},{default:o((()=>[c(p,{modelValue:U.value.position,"onUpdate:modelValue":e[2]||(e[2]=a=>U.value.position=a),placeholder:"è¯·è¾“å…¥èŒä½"},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,{class:"item-label"},{default:o((()=>[i("æ‰‹æœºå·")])),_:1}),c(f,{class:"phone-button","open-type":"getPhoneNumber",onGetphonenumber:I},{default:o((()=>[c(t,{class:"item-content"},{default:o((()=>[U.value.phone?(n(),l(m,{key:0,class:"phone-text"},{default:o((()=>[i(u(r(V)(U.value.phone)),1)])),_:1})):(n(),l(m,{key:1,class:"placeholder-text"},{default:o((()=>[i("ç‚¹å‡»æˆæƒç»‘å®šæ‰‹æœºå·")])),_:1})),c(t,{class:"arrow-icon"},{default:o((()=>[c(m,null,{default:o((()=>[i("â€º")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(t,{class:"save-section"},{default:o((()=>[c(f,{class:"save-btn",onClick:N},{default:o((()=>[i("ä¿å­˜")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-53af33ff"]]);export{x as default};
