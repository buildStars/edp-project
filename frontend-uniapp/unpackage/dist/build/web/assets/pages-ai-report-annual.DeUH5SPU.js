import{H as a,x as t,I as e,Q as s,ag as l,ah as r,ai as n,c as o,w as i,i as c,d,e as u,k as h,t as f,n as g,h as _,j as m,F as p,f as v,R as y,z as D,$ as k}from"./index-Cljxm-NV.js";import{C as w}from"./custom-navbar.DLfdosCP.js";import{g as I,a as C}from"./ai-report.J9RvzJjd.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./icon.DkV2kXZZ.js";/* empty css                                                                      */const b=M({components:{CustomNavbar:w},data:()=>({navbarHeight:44,currentYear:(new Date).getFullYear(),loading:!1,generating:!1,reportData:null,radarCanvas:null,radarColor:"#5470c6",radarIndicators:[],radarValues:[]}),computed:{achievementsList(){var a;return(null==(a=this.reportData)?void 0:a.achievements)?this.reportData.achievements.split("\n").filter((a=>a.trim())):[]},knowledgeList(){var a;return(null==(a=this.reportData)?void 0:a.knowledgePoints)?this.reportData.knowledgePoints.split("\n").filter((a=>a.trim())).map((a=>a.replace(/^[â€¢\-]\s*/,""))):[]},recommendationsList(){var a;return(null==(a=this.reportData)?void 0:a.recommendations)?this.reportData.recommendations.split("\n").filter((a=>a.trim())):[]}},onLoad(a){this.currentYear=(new Date).getFullYear(),"generate"===a.action?this.handleGenerate():this.loadReport()},methods:{async loadReport(){this.loading=!0;try{const a=await I(this.currentYear);this.reportData=a,a&&a.radarData&&this.$nextTick((()=>{this.parseRadarData(a.radarData),this.drawRadarChart()}))}catch(a){console.error("åŠ è½½æŠ¥å‘Šå¤±è´¥:",a),this.reportData=null}finally{this.loading=!1}},async handleGenerate(){var s;this.generating=!0;try{a({title:"AI åˆ†æä¸­..."});const s=await C(this.currentYear,!1);this.reportData=s,t({title:"æŠ¥å‘Šç”ŸæˆæˆåŠŸ",icon:"success"}),s&&s.radarData&&this.$nextTick((()=>{this.parseRadarData(s.radarData),this.drawRadarChart()}))}catch(l){console.error("ç”ŸæˆæŠ¥å‘Šå¤±è´¥:",l),t({title:(null==(s=l.data)?void 0:s.message)||"ç”Ÿæˆå¤±è´¥",icon:"none"})}finally{this.generating=!1,e()}},async handleRegenerate(){var l;if((await s({title:"ç¡®è®¤é‡æ–°ç”Ÿæˆ",content:"å°†ä½¿ç”¨æœ€æ–°æ•°æ®é‡æ–°ç”ŸæˆæŠ¥å‘Šï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ"})).confirm){this.generating=!0;try{a({title:"AI åˆ†æä¸­..."});const s=await C(this.currentYear,!0);this.reportData=s,t({title:"æŠ¥å‘Šå·²æ›´æ–°",icon:"success"}),s&&s.radarData&&this.$nextTick((()=>{this.parseRadarData(s.radarData),this.drawRadarChart()}))}catch(r){console.error("é‡æ–°ç”Ÿæˆå¤±è´¥:",r),t({title:(null==(l=r.data)?void 0:l.message)||"ç”Ÿæˆå¤±è´¥",icon:"none"})}finally{this.generating=!1,e()}}},parseRadarData(a){try{const t=JSON.parse(a);this.radarIndicators=t.indicators||[],this.radarValues=t.values||[],console.log("ğŸ“Š é›·è¾¾å›¾æ•°æ®è§£ææˆåŠŸ:"),console.log("  indicators:",this.radarIndicators),console.log("  values:",this.radarValues)}catch(t){console.error("è§£æé›·è¾¾å›¾æ•°æ®å¤±è´¥:",t),this.radarIndicators=[],this.radarValues=[]}},drawRadarChart(){console.log("ğŸ¨ å¼€å§‹ç»˜åˆ¶é›·è¾¾å›¾..."),console.log("  indicators count:",this.radarIndicators.length),console.log("  values count:",this.radarValues.length),this.radarIndicators.length&&this.radarValues.length?this.$nextTick((()=>{const a=document.getElementById("radarCanvas");if(!a)return void console.error("âŒ H5: æ— æ³•è·å– Canvas å…ƒç´ ");const t=a.getContext("2d"),e=a.getBoundingClientRect(),s=e.width,l=e.height,r=window.devicePixelRatio||1;a.width=s*r,a.height=l*r,t.scale(r,r),console.log("âœ… H5 Canvas å…ƒç´ è·å–æˆåŠŸ:",s,"x",l);const n=s/2,o=l/2,i=Math.min(s,l)/2-40;t.clearRect(0,0,s,l),this.drawRadarGrid(t,n,o,i),this.drawRadarData(t,n,o,i),this.drawRadarLabels(t,n,o,i)})):console.warn("âš ï¸  é›·è¾¾å›¾æ•°æ®ä¸ºç©ºï¼Œè·³è¿‡ç»˜åˆ¶")},drawRadarGrid(a,t,e,s){const l=this.radarIndicators.length,r=2*Math.PI/l;a.strokeStyle="#e0e6f1",a.lineWidth=1;for(let n=1;n<=5;n++){const o=s/5*n;a.beginPath();for(let s=0;s<=l;s++){const l=t+o*Math.cos(r*s-Math.PI/2),n=e+o*Math.sin(r*s-Math.PI/2);0===s?a.moveTo(l,n):a.lineTo(l,n)}a.closePath(),a.stroke()}for(let n=0;n<l;n++){a.beginPath(),a.moveTo(t,e);const l=t+s*Math.cos(r*n-Math.PI/2),o=e+s*Math.sin(r*n-Math.PI/2);a.lineTo(l,o),a.stroke()}},drawRadarData(a,t,e,s){var l,r;const n=this.radarIndicators.length,o=2*Math.PI/n;a.beginPath();for(let i=0;i<n;i++){const r=(this.radarValues[i]||0)/((null==(l=this.radarIndicators[i])?void 0:l.max)||100)*s,n=t+r*Math.cos(o*i-Math.PI/2),c=e+r*Math.sin(o*i-Math.PI/2);0===i?a.moveTo(n,c):a.lineTo(n,c)}a.closePath(),a.fillStyle=this.radarColor+"40",a.fill(),a.strokeStyle=this.radarColor,a.lineWidth=2,a.stroke(),a.fillStyle=this.radarColor;for(let i=0;i<n;i++){const l=(this.radarValues[i]||0)/((null==(r=this.radarIndicators[i])?void 0:r.max)||100)*s,n=t+l*Math.cos(o*i-Math.PI/2),c=e+l*Math.sin(o*i-Math.PI/2);a.beginPath(),a.arc(n,c,4,0,2*Math.PI),a.fill()}},drawRadarLabels(a,t,e,s){var l;const r=this.radarIndicators.length,n=2*Math.PI/r,o=s+20;a.fillStyle="#333",a.font="12px sans-serif",a.textAlign="center",a.textBaseline="middle";for(let i=0;i<r;i++){const s=t+o*Math.cos(n*i-Math.PI/2),r=e+o*Math.sin(n*i-Math.PI/2),c=(null==(l=this.radarIndicators[i])?void 0:l.name)||"";a.fillText(c,s,r)}},handleRadarTouch(){},handleShare(){uni.showShareMenu({withShareTicket:!0,success:()=>{console.log("åˆ†äº«èœå•æ‰“å¼€æˆåŠŸ")}})},formatDate(a){if(!a)return"";const t=new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}}},[["render",function(a,t,e,s,I,C){const M=l(r("custom-navbar"),w),b=c,R=n("uni-load-more"),x=y,P=D,T=k;return d(),o(b,{class:"annual-report"},{default:i((()=>[u(M,{title:"æˆ‘çš„å¹´åº¦æŠ¥å‘Š","show-back":!0}),u(b,{class:"year-display",style:g({marginTop:I.navbarHeight+"px"})},{default:i((()=>[u(b,{class:"current-year"},{default:i((()=>[h(f(I.currentYear)+" å¹´åº¦æŠ¥å‘Š",1)])),_:1})])),_:1},8,["style"]),I.loading?(d(),o(b,{key:0,class:"loading-container"},{default:i((()=>[u(R,{status:"loading"})])),_:1})):I.reportData||I.loading?I.reportData?(d(),o(b,{key:2,class:"report-content"},{default:i((()=>[u(b,{class:"report-cover"},{default:i((()=>[u(b,{class:"cover-bg"}),u(b,{class:"cover-content"},{default:i((()=>[u(b,{class:"year-title"},{default:i((()=>[h(f(I.currentYear),1)])),_:1}),u(b,{class:"report-title"},{default:i((()=>[h("å¹´åº¦å­¦ä¹ æŠ¥å‘Š")])),_:1}),u(b,{class:"generated-time"},{default:i((()=>[h("ç”Ÿæˆäº "+f(C.formatDate(I.reportData.generatedAt)),1)])),_:1})])),_:1})])),_:1}),u(b,{class:"stats-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ“ˆ")])),_:1}),u(P,null,{default:i((()=>[h("å­¦ä¹ ç»Ÿè®¡")])),_:1})])),_:1}),u(b,{class:"stats-grid"},{default:i((()=>[u(b,{class:"stat-item"},{default:i((()=>[u(b,{class:"stat-value"},{default:i((()=>[h(f(I.reportData.totalCredits),1)])),_:1}),u(b,{class:"stat-label"},{default:i((()=>[h("æ€»å­¦åˆ†")])),_:1})])),_:1}),u(b,{class:"stat-item"},{default:i((()=>[u(b,{class:"stat-value"},{default:i((()=>[h(f(I.reportData.totalCourses),1)])),_:1}),u(b,{class:"stat-label"},{default:i((()=>[h("æŠ¥åè¯¾ç¨‹")])),_:1})])),_:1}),u(b,{class:"stat-item"},{default:i((()=>[u(b,{class:"stat-value"},{default:i((()=>[h(f(I.reportData.totalHours),1)])),_:1}),u(b,{class:"stat-label"},{default:i((()=>[h("å­¦ä¹ æ—¶é•¿(å°æ—¶)")])),_:1})])),_:1})])),_:1})])),_:1}),u(b,{class:"radar-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ¯")])),_:1}),u(P,null,{default:i((()=>[h("èƒ½åŠ›åˆ†æ")])),_:1})])),_:1}),u(b,{class:"radar-container"},{default:i((()=>[u(T,{"canvas-id":"radarCanvas",id:"radarCanvas",class:"radar-canvas",onTouchstart:C.handleRadarTouch},null,8,["onTouchstart"])])),_:1}),u(b,{class:"radar-legend"},{default:i((()=>[(d(!0),_(p,null,m(I.radarIndicators,((a,t)=>(d(),o(b,{class:"legend-item",key:t},{default:i((()=>[u(b,{class:"legend-dot",style:g({backgroundColor:I.radarColor})},null,8,["style"]),u(P,null,{default:i((()=>[h(f(a.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),u(b,{class:"summary-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ’¡")])),_:1}),u(P,null,{default:i((()=>[h("å­¦ä¹ æ€»ç»“")])),_:1})])),_:1}),u(b,{class:"content-card"},{default:i((()=>[u(P,{class:"content-text"},{default:i((()=>[h(f(I.reportData.summary),1)])),_:1})])),_:1})])),_:1}),u(b,{class:"achievements-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ†")])),_:1}),u(P,null,{default:i((()=>[h("ä¸»è¦æˆå°±")])),_:1})])),_:1}),u(b,{class:"content-card"},{default:i((()=>[u(b,{class:"achievement-list"},{default:i((()=>[(d(!0),_(p,null,m(C.achievementsList,((a,t)=>(d(),o(b,{class:"achievement-item",key:t},{default:i((()=>[u(b,{class:"achievement-bullet"},{default:i((()=>[h(f(t+1),1)])),_:2},1024),u(P,{class:"achievement-text"},{default:i((()=>[h(f(a),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),u(b,{class:"knowledge-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ“š")])),_:1}),u(P,null,{default:i((()=>[h("å­¦ä¹ çŸ¥è¯†ç‚¹")])),_:1})])),_:1}),u(b,{class:"knowledge-tags"},{default:i((()=>[(d(!0),_(p,null,m(C.knowledgeList,((a,t)=>(d(),o(b,{class:"knowledge-tag",key:t},{default:i((()=>[h(f(a),1)])),_:2},1024)))),128))])),_:1})])),_:1}),u(b,{class:"recommendations-section"},{default:i((()=>[u(b,{class:"section-title"},{default:i((()=>[u(b,{class:"title-icon"},{default:i((()=>[h("ğŸ“")])),_:1}),u(P,null,{default:i((()=>[h("å­¦ä¹ å»ºè®®")])),_:1})])),_:1}),u(b,{class:"content-card"},{default:i((()=>[u(b,{class:"recommendation-list"},{default:i((()=>[(d(!0),_(p,null,m(C.recommendationsList,((a,t)=>(d(),o(b,{class:"recommendation-item",key:t},{default:i((()=>[u(b,{class:"recommendation-icon"},{default:i((()=>[h("ğŸ’ª")])),_:1}),u(P,{class:"recommendation-text"},{default:i((()=>[h(f(a),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),u(b,{class:"actions-section"},{default:i((()=>[u(x,{class:"action-btn primary",onClick:C.handleShare},{default:i((()=>[u(P,{class:"btn-icon"},{default:i((()=>[h("ğŸ“¤")])),_:1}),u(P,null,{default:i((()=>[h("åˆ†äº«æŠ¥å‘Š")])),_:1})])),_:1},8,["onClick"]),u(x,{class:"action-btn",onClick:C.handleRegenerate,loading:I.generating},{default:i((()=>[u(P,{class:"btn-icon"},{default:i((()=>[h("ğŸ”„")])),_:1}),u(P,null,{default:i((()=>[h(f(I.generating?"ç”Ÿæˆä¸­...":"é‡æ–°ç”Ÿæˆ"),1)])),_:1})])),_:1},8,["onClick","loading"])])),_:1}),u(b,{class:"safe-area-bottom"})])),_:1})):v("",!0):(d(),o(b,{key:1,class:"empty-state"},{default:i((()=>[u(b,{class:"empty-icon"},{default:i((()=>[h("ğŸ“Š")])),_:1}),u(b,{class:"empty-text"},{default:i((()=>[h(f(I.currentYear)+" å¹´åº¦æŠ¥å‘Šå°šæœªç”Ÿæˆ",1)])),_:1}),u(x,{class:"generate-btn",onClick:C.handleGenerate,loading:I.generating},{default:i((()=>[h(f(I.generating?"æ­£åœ¨ç”Ÿæˆ...":"ç«‹å³ç”Ÿæˆ"),1)])),_:1},8,["onClick","loading"]),u(b,{class:"empty-tip"},{default:i((()=>[h("AI å°†åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®ï¼Œç”Ÿæˆä¸ªæ€§åŒ–æŠ¥å‘Š")])),_:1})])),_:1}))])),_:1})}],["__scopeId","data-v-9677f07f"]]);export{b as default};
