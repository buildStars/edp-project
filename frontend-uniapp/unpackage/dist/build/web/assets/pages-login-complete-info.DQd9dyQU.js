import{u as e,r as a,B as l,z as s,c as t,w as c,i as n,d as o,e as u,k as i,v as r,t as d,f,C as p,a7 as v,m,D as _,a8 as h,a6 as g,N as y,aq as k,q as b,p as x,T as w,a2 as C}from"./index-BA-OeFd4.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=I({__name:"complete-info",setup(I){const U=e(),V=a(1),T=a({avatar:"/static/images/default-avatar.png",nickname:""}),j=a({phone:"",code:""}),N=a(!1),$=a(0),q=a(!1),P=a(!1);l((()=>{const e=U.userInfo||{};e.avatar&&(T.value.avatar=e.avatar),e.nickname&&(T.value.nickname=e.nickname),e.phone&&(V.value=3)}));const S=s((()=>T.value.nickname&&T.value.nickname.trim().length>0)),z=async e=>{console.log("é€‰æ‹©å¤´åƒ:",e);const a=e.detail.avatarUrl;if(a)try{p({title:"ä¸Šä¼ ä¸­..."});const e=await v(a);console.log("ä¸Šä¼ å¤´åƒè¿”å›ž:",e);let l="";l="string"==typeof e?e:e&&"string"==typeof e.url?e.url:e&&"object"==typeof e.data&&"string"==typeof e.data.url?e.data.url:a,T.value.avatar=l,m({title:"å¤´åƒä¸Šä¼ æˆåŠŸ",icon:"success",duration:1500})}catch(l){console.error("ä¸Šä¼ å¤´åƒå¤±è´¥ï¼š",l),T.value.avatar=a}finally{_()}},A=async()=>{if(S.value)try{p({title:"ä¿å­˜ä¸­..."});const e={avatar:String(T.value.avatar||""),nickname:String(T.value.nickname||"")};console.log("æäº¤æ›´æ–°æ•°æ®:",e),await h(e),await U.fetchUserInfo(),V.value=2}catch(e){console.error("ä¿å­˜å¤±è´¥ï¼š",e),m({title:e.msg||"ä¿å­˜å¤±è´¥",icon:"none"})}finally{_()}else m({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"})},B=async e=>{if(console.log("èŽ·å–æ‰‹æœºå·å›žè°ƒ:",e),"getPhoneNumber:ok"===e.detail.errMsg)try{p({title:"ç»‘å®šä¸­..."}),await g({code:e.detail.code}),await U.fetchUserInfo(),m({title:"ç»‘å®šæˆåŠŸ",icon:"success"}),setTimeout((()=>{V.value=3}),1500)}catch(a){console.error("ç»‘å®šå¤±è´¥ï¼š",a),m({title:a.msg||"ç»‘å®šå¤±è´¥",icon:"none"})}finally{_()}else console.log("ç”¨æˆ·æ‹’ç»æŽˆæƒæ‰‹æœºå·"),m({title:"æ‚¨å–æ¶ˆäº†æŽˆæƒ",icon:"none"})},D=()=>{N.value=!N.value,j.value={phone:"",code:""}},F=async()=>{if(j.value.phone)if(/^1[3-9]\d{9}$/.test(j.value.phone))try{q.value=!0,m({title:"éªŒè¯ç å·²å‘é€",icon:"success"}),$.value=60;const e=setInterval((()=>{$.value--,$.value<=0&&clearInterval(e)}),1e3)}catch(e){console.error("å‘é€éªŒè¯ç å¤±è´¥ï¼š",e),m({title:e.msg||"å‘é€å¤±è´¥",icon:"none"})}finally{q.value=!1}else m({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"});else m({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none"})},G=async()=>{if(j.value.phone)if(/^1[3-9]\d{9}$/.test(j.value.phone))if(j.value.code)try{P.value=!0,p({title:"ç»‘å®šä¸­..."}),await U.fetchUserInfo(),m({title:"ç»‘å®šæˆåŠŸ",icon:"success"}),setTimeout((()=>{V.value=3}),1500)}catch(e){console.error("ç»‘å®šå¤±è´¥ï¼š",e),m({title:e.msg||"ç»‘å®šå¤±è´¥",icon:"none"})}finally{P.value=!1,_()}else m({title:"è¯·è¾“å…¥éªŒè¯ç ",icon:"none"});else m({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"});else m({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none"})},L=async()=>{y({title:"æç¤º",content:"è·³è¿‡åŽæ‚¨å¯ä»¥ç¨åŽåœ¨ä¸ªäººä¸­å¿ƒå®Œå–„ä¿¡æ¯",confirmText:"ç»§ç»­è·³è¿‡",success:e=>{e.confirm&&(V.value=2)}})},M=async()=>{y({title:"æç¤º",content:"è·³è¿‡ç»‘å®šåŽå°†æ— æ³•æŠ¥åè¯¾ç¨‹ï¼Œç¡®å®šè¦è·³è¿‡å—ï¼Ÿ",confirmText:"ç»§ç»­è·³è¿‡",success:async e=>{if(e.confirm){try{await h({profileCompleted:!0}),await U.fetchUserInfo()}catch(a){console.error("ä¿å­˜å¤±è´¥ï¼š",a)}V.value=3}}})},E=async()=>{try{p({title:"ä¿å­˜ä¸­..."}),await h({profileCompleted:!0}),await U.fetchUserInfo(),_(),k({url:"/pages/index/index"})}catch(e){console.error("ä¿å­˜å¤±è´¥ï¼š",e),_(),k({url:"/pages/index/index"})}};return(e,a)=>{const l=n,s=b,p=x,v=w,m=C;return o(),t(l,{class:"page"},{default:c((()=>[u(l,{class:"container"},{default:c((()=>[u(l,{class:"welcome-section"},{default:c((()=>[u(l,{class:"icon"},{default:c((()=>[i("ðŸŽ‰")])),_:1}),u(l,{class:"title"},{default:c((()=>[i("æ¬¢è¿ŽåŠ å…¥")])),_:1}),u(l,{class:"subtitle"},{default:c((()=>[i("å®Œå–„æ‚¨çš„ä¸ªäººä¿¡æ¯")])),_:1})])),_:1}),u(l,{class:"progress-section"},{default:c((()=>[u(l,{class:r(["progress-item",{active:V.value>=1,completed:V.value>1}])},{default:c((()=>[u(l,{class:"progress-number"},{default:c((()=>[i(d(V.value>1?"âœ“":"1"),1)])),_:1}),u(s,{class:"progress-text"},{default:c((()=>[i("å¤´åƒæ˜µç§°")])),_:1})])),_:1},8,["class"]),u(l,{class:r(["progress-line",{active:V.value>=2}])},null,8,["class"]),u(l,{class:r(["progress-item",{active:V.value>=2,completed:V.value>2}])},{default:c((()=>[u(l,{class:"progress-number"},{default:c((()=>[i(d(V.value>2?"âœ“":"2"),1)])),_:1}),u(s,{class:"progress-text"},{default:c((()=>[i("ç»‘å®šæ‰‹æœº")])),_:1})])),_:1},8,["class"]),u(l,{class:r(["progress-line",{active:V.value>=3}])},null,8,["class"]),u(l,{class:r(["progress-item",{active:V.value>=3}])},{default:c((()=>[u(l,{class:"progress-number"},{default:c((()=>[i("3")])),_:1}),u(s,{class:"progress-text"},{default:c((()=>[i("å®Œæˆ")])),_:1})])),_:1},8,["class"])])),_:1}),1===V.value?(o(),t(l,{key:0,class:"step-content"},{default:c((()=>[u(l,{class:"form-section"},{default:c((()=>[u(l,{class:"form-item center"},{default:c((()=>[u(l,{class:"form-label"},{default:c((()=>[i("é€‰æ‹©å¤´åƒ")])),_:1}),u(v,{class:"avatar-choose-btn","open-type":"chooseAvatar",onChooseavatar:z},{default:c((()=>[u(l,{class:"avatar-wrapper"},{default:c((()=>[u(p,{src:T.value.avatar,class:"avatar-img",mode:"aspectFill"},null,8,["src"]),u(l,{class:"avatar-mask"},{default:c((()=>[u(s,{class:"icon"},{default:c((()=>[i("ðŸ“·")])),_:1})])),_:1})])),_:1})])),_:1}),u(s,{class:"tip"},{default:c((()=>[i("ç‚¹å‡»å¤´åƒé€‰æ‹©")])),_:1})])),_:1}),u(l,{class:"form-item"},{default:c((()=>[u(l,{class:"form-label"},{default:c((()=>[i("æ˜µç§°")])),_:1}),u(m,{modelValue:T.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>T.value.nickname=e),type:"nickname",placeholder:"è¯·è¾“å…¥æ˜µç§°","placeholder-class":"input-placeholder",class:"form-input",maxlength:"20"},null,8,["modelValue"]),u(l,{class:"input-tip"},{default:c((()=>[u(s,{class:"tip-icon"},{default:c((()=>[i("ðŸ’¡")])),_:1}),u(s,null,{default:c((()=>[i("è¾“å…¥æ¡†ä¸Šæ–¹ä¼šæ˜¾ç¤ºæ‚¨çš„å¾®ä¿¡æ˜µç§°")])),_:1})])),_:1})])),_:1})])),_:1}),u(v,{class:"next-btn",onClick:A,disabled:!S.value},{default:c((()=>[i(" ä¸‹ä¸€æ­¥ ")])),_:1},8,["disabled"]),u(v,{class:"skip-btn",onClick:L},{default:c((()=>[i(" è·³è¿‡ ")])),_:1})])),_:1})):f("",!0),2===V.value?(o(),t(l,{key:1,class:"step-content"},{default:c((()=>[u(l,{class:"phone-section"},{default:c((()=>[u(l,{class:"phone-icon"},{default:c((()=>[i("ðŸ“±")])),_:1}),u(l,{class:"phone-title"},{default:c((()=>[i("ç»‘å®šæ‰‹æœºå·")])),_:1}),u(l,{class:"phone-desc"},{default:c((()=>[i("ä¸ºäº†æ‚¨çš„è´¦å·å®‰å…¨ï¼Œè¯·ç»‘å®šæ‰‹æœºå·")])),_:1}),N.value?f("",!0):(o(),t(v,{key:0,"open-type":"getPhoneNumber",onGetphonenumber:B,class:"phone-btn"},{default:c((()=>[u(s,{class:"btn-icon"},{default:c((()=>[i("ðŸ“±")])),_:1}),u(s,null,{default:c((()=>[i("å¾®ä¿¡æŽˆæƒèŽ·å–æ‰‹æœºå·")])),_:1})])),_:1})),N.value?(o(),t(l,{key:1,class:"manual-input-form"},{default:c((()=>[u(l,{class:"form-item"},{default:c((()=>[u(m,{modelValue:j.value.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value.phone=e),type:"number",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·","placeholder-class":"input-placeholder",class:"form-input",maxlength:"11"},null,8,["modelValue"])])),_:1}),u(l,{class:"form-item code-item"},{default:c((()=>[u(m,{modelValue:j.value.code,"onUpdate:modelValue":a[2]||(a[2]=e=>j.value.code=e),type:"number",placeholder:"è¯·è¾“å…¥éªŒè¯ç ","placeholder-class":"input-placeholder",class:"form-input",maxlength:"6"},null,8,["modelValue"]),u(v,{class:"code-btn",disabled:q.value||$.value>0,onClick:F},{default:c((()=>[i(d($.value>0?`${$.value}s`:"èŽ·å–éªŒè¯ç "),1)])),_:1},8,["disabled"])])),_:1}),u(v,{class:"phone-btn",onClick:G,disabled:P.value},{default:c((()=>[i(d(P.value?"ç»‘å®šä¸­...":"ç¡®è®¤ç»‘å®š"),1)])),_:1},8,["disabled"])])),_:1})):f("",!0),N.value?f("",!0):(o(),t(l,{key:2,class:"or-divider"},{default:c((()=>[u(l,{class:"line"}),u(s,null,{default:c((()=>[i("æˆ–")])),_:1}),u(l,{class:"line"})])),_:1})),u(v,{class:"manual-btn",onClick:D},{default:c((()=>[i(d(N.value?"è¿”å›žå¾®ä¿¡æŽˆæƒ":"æ‰‹åŠ¨è¾“å…¥æ‰‹æœºå·"),1)])),_:1})])),_:1}),u(v,{class:"skip-btn",onClick:M},{default:c((()=>[i(" æš‚ä¸ç»‘å®š ")])),_:1})])),_:1})):f("",!0),3===V.value?(o(),t(l,{key:2,class:"step-content success"},{default:c((()=>[u(l,{class:"success-icon"},{default:c((()=>[i("âœ…")])),_:1}),u(l,{class:"success-title"},{default:c((()=>[i("è®¾ç½®å®Œæˆ")])),_:1}),u(l,{class:"success-desc"},{default:c((()=>[i("æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†")])),_:1}),u(v,{class:"complete-btn",onClick:E},{default:c((()=>[i(" å¼€å§‹ä½¿ç”¨ ")])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-85ee7183"]]);export{U as default};
