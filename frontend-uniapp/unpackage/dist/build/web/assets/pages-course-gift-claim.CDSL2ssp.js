import{u as e,D as a,r as l,G as s,p as t,Q as c,al as i,x as u,ai as o,c as r,w as n,i as d,d as f,e as v,k as g,t as p,am as _,z as m,y,R as k}from"./index-Cljxm-NV.js";import{c as x}from"./course-gift.CMB_jCIL.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=b({__name:"claim",setup(b){const z=e(),w=a((()=>!!z.token)),C=l(!0),h=l(!1),j=l(!1),L=l(""),$=l(null),A=l("");s((async e=>{const a=e.code;if(!a)return A.value="礼物码无效",void(C.value=!1);if(L.value=a,!w.value){return t("redirectAfterLogin",`/pages/course-gift/claim?code=${a}`),c({title:"提示",content:"请先登录后领取课程",confirmText:"去登录",success:e=>{e.confirm?i({url:"/pages/login/index"}):i({url:"/pages/index/index"})}}),void(C.value=!1)}await I()}));const I=async()=>{try{C.value=!0;const e=await x({giftCode:L.value});e.course&&($.value=e.course,j.value=!0,u({title:"领取成功！",icon:"success"}))}catch(e){e.msg&&e.msg.includes("已报名")?(A.value="您已经拥有这门课程了",j.value=!0):A.value=e.msg||"礼物码无效或已被领取"}finally{C.value=!1}},R=async()=>{if(!w.value){const e=`/pages/course-gift/claim?code=${L.value}`;return t("redirectAfterLogin",e),void i({url:"/pages/login/index"})}await I()},D=()=>{$.value&&_({url:`/pages/course/detail?id=${$.value.id}`})},F=()=>{i({url:"/pages/index/index"})};return(e,a)=>{const l=o("uni-icons"),s=m,t=d,c=y,i=k;return f(),r(t,{class:"page"},{default:n((()=>[C.value?(f(),r(t,{key:0,class:"loading-container"},{default:n((()=>[v(l,{type:"spinner-cycle",size:"60",color:"#2979ff",class:"loading-icon"}),v(s,{class:"loading-text"},{default:n((()=>[g("正在加载...")])),_:1})])),_:1})):$.value?(f(),r(t,{key:1,class:"content"},{default:n((()=>[v(t,{class:"gift-card"},{default:n((()=>[v(c,{src:$.value.coverImage,class:"course-cover",mode:"aspectFill"},null,8,["src"]),v(t,{class:"gift-icon"},{default:n((()=>[v(l,{type:"gift",size:"80",color:"#ff6b6b"})])),_:1}),v(t,{class:"course-title"},{default:n((()=>[g(p($.value.title),1)])),_:1}),v(t,{class:"credit-info"},{default:n((()=>[v(s,{class:"credit-label"},{default:n((()=>[g("课程价值")])),_:1}),v(s,{class:"credit-value"},{default:n((()=>[g(p($.value.credit)+" 学分",1)])),_:1})])),_:1}),v(t,{class:"gift-message"},{default:n((()=>[g(" 好友向你赠送了这门课程 ")])),_:1}),j.value?(f(),r(t,{key:1,class:"claimed-tip"},{default:n((()=>[v(l,{type:"checkmarkempty",size:"30",color:"#4caf50"}),v(s,null,{default:n((()=>[g("已领取")])),_:1})])),_:1})):(f(),r(i,{key:0,class:"claim-btn",onClick:R,disabled:h.value},{default:n((()=>[h.value?(f(),r(s,{key:1},{default:n((()=>[g("领取中...")])),_:1})):(f(),r(s,{key:0},{default:n((()=>[g(p(w.value?"立即领取":"登录后领取"),1)])),_:1}))])),_:1},8,["disabled"]))])),_:1}),v(i,{class:"detail-btn",onClick:D},{default:n((()=>[g(" 查看课程详情 ")])),_:1})])),_:1})):(f(),r(t,{key:2,class:"error-container"},{default:n((()=>[v(l,{type:"closeempty",size:"80",color:"#999"}),v(s,{class:"error-text"},{default:n((()=>[g(p(A.value),1)])),_:1}),v(i,{class:"back-btn",onClick:F},{default:n((()=>[g(" 返回首页 ")])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-ba9a97c9"]]);export{z as default};
