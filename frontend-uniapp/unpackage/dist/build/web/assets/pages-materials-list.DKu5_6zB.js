import{U as e,r as a,D as l,G as s,an as t,x as o,c as i,w as c,i as n,d as r,e as u,k as d,t as f,h as p,j as _,F as m,f as v,z as y,H as g,Y as h,ao as w,I as x,Q as C,ap as T,R as k}from"./index-Cljxm-NV.js";import{E as I}from"./empty-view.C6sbClhI.js";import{I as F}from"./icon.DkV2kXZZ.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";/* empty css                                                                   */const j=U({__name:"list",setup(U){const j=a(""),P=a(""),z=a({title:""}),B=a(""),R=a([]),$=a(!1),b=l((()=>B.value||z.value.title||"è¯¾ä»¶èµ„æ–™")),G=l((()=>P.value?"ç« èŠ‚è¯¾ä»¶èµ„æ–™":"è¯¾ç¨‹è¯¾ä»¶èµ„æ–™"));s((async e=>{j.value=e.courseId,P.value=e.chapterId||"",e.courseTitle&&(z.value.title=decodeURIComponent(e.courseTitle)),e.chapterTitle&&(B.value=decodeURIComponent(e.chapterTitle)),await M()}));const M=async()=>{$.value=!0;try{const e=await t(j.value,P.value||null);R.value=e||[],console.log("ğŸ“š è¯¾ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸ:",R.value.length,"ä¸ªè¯¾ä»¶")}catch(e){console.error("âŒ åŠ è½½è¯¾ä»¶åˆ—è¡¨å¤±è´¥ï¼š",e),o({title:e.msg||"åŠ è½½å¤±è´¥",icon:"none"})}finally{$.value=!1}},D=async a=>{console.log("ğŸ“¥ å¼€å§‹ä¸‹è½½è¯¾ä»¶:",a.title,a.fileUrl),g({title:"å‡†å¤‡ä¸‹è½½...",mask:!0});try{h({url:a.fileUrl,timeout:6e4,success:async l=>{if(console.log("ğŸ“¥ ä¸‹è½½å“åº”:",l.statusCode),200===l.statusCode){const s=l.tempFilePath;console.log("ğŸ“¥ ä¸´æ—¶æ–‡ä»¶:",s),w({tempFilePath:s,success:async l=>{const s=l.savedFilePath;console.log("âœ… æ–‡ä»¶å·²ä¿å­˜:",s),x();try{await(t={materialId:a.id},e("/api/materials/downloads/record",t)),console.log("âœ… ä¸‹è½½è®°å½•æˆåŠŸ")}catch(i){console.error("âŒ è®°å½•ä¸‹è½½å¤±è´¥:",i)}var t;C({title:"ä¸‹è½½æˆåŠŸ",content:`ã€Š${a.title}ã€‹å·²ä¿å­˜ï¼Œæ˜¯å¦ç«‹å³æ‰“å¼€ï¼Ÿ`,confirmText:"æ‰“å¼€",cancelText:"ç¨å",success:e=>{e.confirm&&T({filePath:s,fileType:a.fileType||"pdf",showMenu:!0,success:()=>{console.log("âœ… æ–‡ä»¶å·²æ‰“å¼€")},fail:e=>{console.error("âŒ æ‰“å¼€å¤±è´¥:",e),o({title:"æ— æ³•æ‰“å¼€è¯¥æ–‡ä»¶",icon:"none",duration:2e3})}})}})},fail:e=>{x(),console.error("âŒ ä¿å­˜å¤±è´¥:",e),o({title:"ä¿å­˜å¤±è´¥",icon:"none"})}})}else x(),console.error("âŒ ä¸‹è½½å¤±è´¥:",l.statusCode),o({title:`ä¸‹è½½å¤±è´¥(${l.statusCode})`,icon:"none"})},fail:e=>{x(),console.error("âŒ ä¸‹è½½é”™è¯¯:",e),o({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}}).onProgressUpdate((e=>{g({title:`ä¸‹è½½ä¸­ ${e.progress}%`,mask:!0}),console.log("ä¸‹è½½è¿›åº¦:",e.progress+"%")}))}catch(l){x(),console.error("âŒ ä¸‹è½½å¼‚å¸¸:",l),o({title:"ä¸‹è½½å¤±è´¥",icon:"none"})}};return(e,a)=>{const l=y,s=n,t=k;return r(),i(s,{class:"page"},{default:c((()=>[u(s,{class:"course-header"},{default:c((()=>[u(l,{class:"course-title"},{default:c((()=>[d(f(b.value),1)])),_:1}),u(l,{class:"course-subtitle"},{default:c((()=>[d(f(G.value),1)])),_:1})])),_:1}),u(s,{class:"materials-list"},{default:c((()=>[(r(!0),p(m,null,_(R.value,(e=>(r(),i(s,{key:e.id,class:"material-item"},{default:c((()=>[u(s,{class:"material-icon"},{default:c((()=>[u(l,{class:"icon"},{default:c((()=>[d("ğŸ“„")])),_:1})])),_:1}),u(s,{class:"material-info"},{default:c((()=>[u(l,{class:"material-title"},{default:c((()=>[d(f(e.title),1)])),_:2},1024),u(s,{class:"material-meta"},{default:c((()=>[u(l,{class:"file-type"},{default:c((()=>[d(f(e.fileType.toUpperCase()),1)])),_:2},1024),u(l,{class:"file-size"},{default:c((()=>{return[d(f((a=e.fileSize,a?a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB":"--")),1)];var a})),_:2},1024)])),_:2},1024)])),_:2},1024),u(t,{class:"btn-download",onClick:a=>D(e)},{default:c((()=>[u(F,{name:"download",size:32,color:"#fff"}),u(l,null,{default:c((()=>[d("ä¸‹è½½")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),$.value||0!==R.value.length?v("",!0):(r(),i(I,{key:0,text:"æš‚æ— è¯¾ä»¶"})),$.value?(r(),i(s,{key:1,class:"loading"},{default:c((()=>[u(l,null,{default:c((()=>[d("åŠ è½½ä¸­...")])),_:1})])),_:1})):v("",!0)])),_:1}),u(s,{class:"download-tip"},{default:c((()=>[u(l,{class:"tip-icon"},{default:c((()=>[d("ğŸ’¡")])),_:1}),u(l,{class:"tip-text"},{default:c((()=>[d("ç‚¹å‡»ä¸‹è½½æŒ‰é’®å³å¯ä¿å­˜è¯¾ä»¶åˆ°æœ¬åœ°")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-33351690"]]);export{j as default};
