import{r as a,B as e,g as l,$ as s,V as t,W as u,m as c,c as n,w as d,i as o,d as i,e as r,n as v,k as h,t as f,v as _,f as k,H as m,h as p,j as C,F as I,R as y,C as g,D as E,l as b,q as D,T as w,a2 as j}from"./index-CCW0MaS3.js";import{a as H}from"./chapter.CPjARXA3.js";import{g as $,c as x}from"./checkin.FGmzj8oD.js";import{f as z}from"./util.BUrGU9NL.js";import{C as M}from"./custom-navbar.BHVMyGgk.js";import{E as Y}from"./empty-view.CjXDJwW7.js";import{I as T}from"./icon.Br2I0aeN.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";/* empty css                                                                      *//* empty css                                                                   */const F=S({__name:"chapter-detail",setup(S){const F=a(88),K=a(""),L=a(null),N=a(!1),U=a(!1),V=a(""),A=a({hasActiveSession:!1,canCheckin:!1,alreadyCheckedIn:!1,remainingMinutes:0}),B=a(0),O=a(0),P=a(0),R=a([]),q=a([]);e((a=>{console.log("ç« èŠ‚è¯¦æƒ…é¡µå‚æ•°:",a);const e=l().statusBarHeight||0;F.value=e+44,K.value=a.chapterId||a.id,K.value&&G()})),s("evaluationSubmitted",(async()=>{console.log("ğŸ“ æ”¶åˆ°è¯„ä»·æäº¤äº‹ä»¶ï¼Œé‡æ–°åŠ è½½ç« èŠ‚è¯¦æƒ…"),await G()})),t((()=>{u("evaluationSubmitted")}));const G=async()=>{if(!N.value){N.value=!0;try{const a=await H(K.value);L.value=a,a._count&&(B.value=a._count.materials||0,O.value=a._count.checkinSessions||0,P.value=a._count.evaluations||0),a.materials&&(R.value=a.materials),a.checkins&&(q.value=a.checkins),await Q()}catch(a){console.error("åŠ è½½ç« èŠ‚è¯¦æƒ…å¤±è´¥:",a),c({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{N.value=!1}}},Q=async()=>{var a;try{const e=await $({courseId:null==(a=L.value)?void 0:a.courseId,chapterId:K.value});A.value=e}catch(e){console.error("è·å–ç­¾åˆ°ä¼šè¯å¤±è´¥:",e)}},W=async()=>{var a;if(V.value&&6===V.value.length)try{g({title:"ç­¾åˆ°ä¸­..."}),await x({courseId:null==(a=L.value)?void 0:a.courseId,chapterId:K.value,code:V.value}),E(),U.value=!1,V.value="",A.value.alreadyCheckedIn=!0,A.value.canCheckin=!1,await G(),c({title:"ç­¾åˆ°æˆåŠŸ",icon:"success",duration:2e3})}catch(e){console.error("ç­¾åˆ°å¤±è´¥:",e),E(),c({title:e.msg||e.message||"ç­¾åˆ°å¤±è´¥",icon:"none"})}else c({title:"è¯·è¾“å…¥6ä½ç­¾åˆ°ç ",icon:"none"})},J=a=>({DRAFT:"è‰ç¨¿",PUBLISHED:"å·²å‘å¸ƒ",COMPLETED:"å·²å®Œæˆ"}[a]||"æœªçŸ¥"),X=()=>{var a,e,l,s;(null==(a=L.value)?void 0:a.hasCheckedIn)?(null==(e=L.value)?void 0:e.hasEvaluated)?b({url:`/pages/materials/list?courseId=${null==(l=L.value)?void 0:l.courseId}&chapterId=${K.value}&chapterTitle=${encodeURIComponent((null==(s=L.value)?void 0:s.title)||"")}`}):c({title:"è¯·å…ˆå®Œæˆè¯„ä»·åæŸ¥çœ‹è¯¾ä»¶",icon:"none"}):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°",icon:"none"})},Z=()=>{var a,e;(null==(a=L.value)?void 0:a.hasCheckedIn)?b({url:`/pages/evaluation/create?courseId=${null==(e=L.value)?void 0:e.courseId}&chapterId=${K.value}`}):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°",icon:"none"})},aa=()=>{var a,e,l,s;(null==(a=L.value)?void 0:a.hasCheckedIn)?(null==(e=L.value)?void 0:e.hasEvaluated)?(console.log("ğŸ“– æŸ¥çœ‹è¯„ä»·è®°å½•"),b({url:`/pages/evaluation/create?courseId=${null==(l=L.value)?void 0:l.courseId}&chapterId=${K.value}&viewMode=true`})):(console.log("ğŸ“ åˆ›å»ºè¯„ä»·"),b({url:`/pages/evaluation/create?courseId=${null==(s=L.value)?void 0:s.courseId}&chapterId=${K.value}`})):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°åå†è¯„ä»·",icon:"none"})},ea=()=>{b({url:"/pages/checkin/records"})};return(a,e)=>{const l=o,s=D,t=w,u=j;return i(),n(l,{class:"page"},{default:d((()=>{var a;return[r(M,{title:(null==(a=L.value)?void 0:a.title)||"ç« èŠ‚è¯¦æƒ…","show-back":!0},null,8,["title"]),r(l,{class:"navbar-placeholder",style:v({height:F.value+"px"})},null,8,["style"]),L.value?(i(),n(l,{key:0,class:"chapter-info-card"},{default:d((()=>[r(l,{class:"info-header"},{default:d((()=>{return[r(l,{class:"chapter-number"},{default:d((()=>[r(s,{class:"number-text"},{default:d((()=>[h("ç¬¬"+f(L.value.sortOrder)+"èŠ‚",1)])),_:1})])),_:1}),r(l,{class:_(["chapter-status",(a=L.value.status,`status-${a.toLowerCase()}`)])},{default:d((()=>[h(f(J(L.value.status)),1)])),_:1},8,["class"])];var a})),_:1}),r(l,{class:"chapter-title"},{default:d((()=>[h(f(L.value.title),1)])),_:1}),L.value.description?(i(),n(l,{key:0,class:"chapter-desc"},{default:d((()=>[h(f(L.value.description),1)])),_:1})):k("",!0),r(l,{class:"chapter-meta"},{default:d((()=>[L.value.duration?(i(),n(l,{key:0,class:"meta-item"},{default:d((()=>[r(T,{name:"time",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(L.value.duration)+"åˆ†é’Ÿ",1)])),_:1})])),_:1})):k("",!0),L.value.startTime?(i(),n(l,{key:1,class:"meta-item"},{default:d((()=>[r(T,{name:"time",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(m(z)(L.value.startTime,"YYYY-MM-DD HH:mm")),1)])),_:1})])),_:1})):k("",!0),L.value.location?(i(),n(l,{key:2,class:"meta-item"},{default:d((()=>[r(T,{name:"location",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(L.value.location),1)])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})):k("",!0),L.value?(i(),n(l,{key:1,class:"action-section"},{default:d((()=>[A.value.canCheckin&&!A.value.alreadyCheckedIn?(i(),n(t,{key:0,class:"btn-checkin",onClick:e[0]||(e[0]=a=>U.value=!0)},{default:d((()=>[r(T,{name:"check",size:32,color:"#fff"}),r(s,null,{default:d((()=>[h("ç«‹å³ç­¾åˆ°ï¼ˆå‰©ä½™"+f(A.value.remainingMinutes)+"åˆ†é’Ÿï¼‰",1)])),_:1})])),_:1})):A.value.alreadyCheckedIn?(i(),n(t,{key:1,class:"btn-checked-in",disabled:""},{default:d((()=>[r(T,{name:"check",size:32,color:"#fff"}),r(s,null,{default:d((()=>[h("å·²ç­¾åˆ°")])),_:1})])),_:1})):k("",!0),A.value.alreadyCheckedIn&&!L.value.hasEvaluated?(i(),n(t,{key:2,class:"btn-evaluate",onClick:Z},{default:d((()=>[r(s,null,{default:d((()=>[h("â­ è¯„ä»·æœ¬èŠ‚")])),_:1})])),_:1})):A.value.alreadyCheckedIn&&L.value.hasEvaluated?(i(),n(t,{key:3,class:"btn-evaluated",disabled:""},{default:d((()=>[r(s,null,{default:d((()=>[h("â­ å·²è¯„ä»·")])),_:1})])),_:1})):k("",!0)])),_:1})):k("",!0),r(l,{class:"function-section"},{default:d((()=>[r(l,{class:"section-title"},{default:d((()=>[h("ç« èŠ‚å†…å®¹")])),_:1}),r(l,{class:"function-grid"},{default:d((()=>{var a,e,s,t,u,c;return[r(l,{class:_(["function-card",[(null==(a=L.value)?void 0:a.hasCheckedIn)?"card-success":"card-default",(null==(e=L.value)?void 0:e.hasCheckedIn)?"":"card-locked"]]),onClick:ea},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e;return[r(T,{name:(null==(a=L.value)?void 0:a.hasCheckedIn)?"check":"clock-o",size:64,color:(null==(e=L.value)?void 0:e.hasCheckedIn)?"#52C41A":"#999"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("ç­¾åˆ°è®°å½•")])),_:1}),r(l,{class:_(["card-status",(null==(a=L.value)?void 0:a.hasCheckedIn)?"status-success":"status-default"])},{default:d((()=>{var a;return[h(f((null==(a=L.value)?void 0:a.hasCheckedIn)?"å·²ç­¾åˆ°":"æœªç­¾åˆ°"),1)]})),_:1},8,["class"]),(null==(e=L.value)?void 0:e.hasCheckedIn)?k("",!0):(i(),n(l,{key:0,class:"card-tip"},{default:d((()=>[h("è¯·å…ˆç­¾åˆ°")])),_:1}))]})),_:1},8,["class"]),r(l,{class:_(["function-card",[(null==(s=L.value)?void 0:s.hasEvaluated)?"card-success":"card-default",(null==(t=L.value)?void 0:t.hasCheckedIn)?"":"card-locked"]]),onClick:aa},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e,l,s;return[r(T,{name:(null==(a=L.value)?void 0:a.hasEvaluated)?"star":(null==(e=L.value)?void 0:e.hasCheckedIn)?"star-o":"lock",size:64,color:(null==(l=L.value)?void 0:l.hasEvaluated)?"#FF9800":(null==(s=L.value)?void 0:s.hasCheckedIn)?"#999":"#ccc"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("è¯¾ç¨‹è¯„ä»·")])),_:1}),r(l,{class:_(["card-status",(null==(a=L.value)?void 0:a.hasEvaluated)?"status-success":"status-default"])},{default:d((()=>{var a,e;return[h(f((null==(a=L.value)?void 0:a.hasEvaluated)?"å·²è¯„ä»·":(null==(e=L.value)?void 0:e.hasCheckedIn)?"æœªè¯„ä»·":"å·²é”å®š"),1)]})),_:1},8,["class"]),(null==(e=L.value)?void 0:e.hasCheckedIn)?k("",!0):(i(),n(l,{key:0,class:"card-tip"},{default:d((()=>[h("ç­¾åˆ°åè§£é”")])),_:1}))]})),_:1},8,["class"]),r(l,{class:_(["function-card",[(null==(u=L.value)?void 0:u.hasEvaluated)?"card-success":"card-default",(null==(c=L.value)?void 0:c.hasEvaluated)?"":"card-locked"]]),onClick:X},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e;return[r(T,{name:(null==(a=L.value)?void 0:a.hasEvaluated)?"course":"lock",size:64,color:(null==(e=L.value)?void 0:e.hasEvaluated)?"#C8161D":"#ccc"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("è¯¾ä»¶èµ„æ–™")])),_:1}),(null==(a=L.value)?void 0:a.hasEvaluated)?(i(),n(l,{key:0,class:"card-count"},{default:d((()=>[h(f(B.value)+"ä»½",1)])),_:1})):(i(),n(l,{key:1,class:"card-status status-default"},{default:d((()=>[h("å·²é”å®š")])),_:1})),(null==(e=L.value)?void 0:e.hasEvaluated)?k("",!0):(i(),n(l,{key:2,class:"card-tip"},{default:d((()=>[h("è¯„ä»·åè§£é”")])),_:1}))]})),_:1},8,["class"])]})),_:1})])),_:1}),q.value.length>0?(i(),n(l,{key:2,class:"checkins-section"},{default:d((()=>[r(l,{class:"section-header"},{default:d((()=>[r(s,{class:"section-title"},{default:d((()=>[h("ç­¾åˆ°è®°å½•")])),_:1}),r(s,{class:"section-more"},{default:d((()=>[h("æŸ¥çœ‹å…¨éƒ¨")])),_:1})])),_:1}),(i(!0),p(I,null,C(q.value.slice(0,3),(a=>(i(),n(l,{key:a.id,class:"checkin-item"},{default:d((()=>[r(l,{class:_(["checkin-status","CHECKED_IN"===a.status?"checked":"missed"])},{default:d((()=>[r(T,{name:"CHECKED_IN"===a.status?"check":"close",size:32,color:"#fff"},null,8,["name"])])),_:2},1032,["class"]),r(l,{class:"checkin-info"},{default:d((()=>[r(l,{class:"checkin-title"},{default:d((()=>[h("ç­¾åˆ°ç : "+f(a.code),1)])),_:2},1024),r(l,{class:"checkin-time"},{default:d((()=>[h(f(m(z)(a.checkinTime,"YYYY-MM-DD HH:mm")),1)])),_:2},1024)])),_:2},1024),r(l,{class:_(["checkin-badge","CHECKED_IN"===a.status?"success":"error"])},{default:d((()=>[h(f("CHECKED_IN"===a.status?"å·²ç­¾åˆ°":"ç¼ºå‹¤"),1)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})):k("",!0),N.value||L.value?k("",!0):(i(),n(Y,{key:3,text:"ç« èŠ‚ä¿¡æ¯åŠ è½½å¤±è´¥"})),N.value?(i(),n(l,{key:4,class:"loading-container"},{default:d((()=>[r(s,{class:"loading-text"},{default:d((()=>[h("åŠ è½½ä¸­...")])),_:1})])),_:1})):k("",!0),U.value?(i(),n(l,{key:5,class:"modal-overlay",onClick:e[4]||(e[4]=a=>U.value=!1)},{default:d((()=>[r(l,{class:"checkin-modal",onClick:e[3]||(e[3]=y((()=>{}),["stop"]))},{default:d((()=>[r(l,{class:"modal-title"},{default:d((()=>[h("ç« èŠ‚ç­¾åˆ°")])),_:1}),r(l,{class:"modal-subtitle"},{default:d((()=>[h("è¯·è¾“å…¥è€å¸ˆå‘ŠçŸ¥çš„6ä½æ•°å­—ç­¾åˆ°ç ")])),_:1}),r(l,{class:"code-input-section"},{default:d((()=>[r(u,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),type:"number",maxlength:"6",placeholder:"è¯·è¾“å…¥6ä½ç­¾åˆ°ç ",class:"code-input",onConfirm:W},null,8,["modelValue"]),r(t,{class:"btn-submit-code",onClick:W},{default:d((()=>[h("ç«‹å³ç­¾åˆ°")])),_:1})])),_:1}),r(t,{class:"btn-cancel",onClick:e[2]||(e[2]=a=>U.value=!1)},{default:d((()=>[h(" å–æ¶ˆ ")])),_:1})])),_:1})])),_:1})):k("",!0)]})),_:1})}}},[["__scopeId","data-v-a5d5dd4d"]]);export{F as default};
