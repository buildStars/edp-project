import{r as a,G as e,a as s,x as t,ar as l,c,w as o,i as u,d as r,e as i,k as n,t as d,h as m,j as p,F as f,f as _,z as y,y as v,L as g,A as h,_ as I,l as k,Q as w,H as j,I as x,ae as C,R as S}from"./index-Cljxm-NV.js";import{_ as $}from"./empty.Dy77HuBL.js";import{p as b}from"./corporate.DD7aqQRZ.js";import{f as E}from"./util.DiFpgDCN.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=F({__name:"purchase-course",setup(F){const L=a(""),N=a(""),P=a([]),U=a(!1),z=a(0);e((async a=>{L.value=a.employeeId,N.value=decodeURIComponent(a.employeeName||""),await H(),await O()}));const H=async()=>{U.value=!0;try{const a=await s({status:"PUBLISHED",page:1,pageSize:100});P.value=a.items||[]}catch(a){t({title:a.message||"加载失败",icon:"none"})}finally{U.value=!1}},O=async()=>{try{const a=await l();z.value=a.balance||0}catch(a){console.error("加载学分失败:",a)}};return(a,e)=>{const s=y,l=u,F=v,H=S;return r(),c(l,{class:"page-container"},{default:o((()=>[i(l,{class:"employee-info-card"},{default:o((()=>[i(s,{class:"label"},{default:o((()=>[n("为以下员工购买课程：")])),_:1}),i(s,{class:"employee-name"},{default:o((()=>[n(d(N.value),1)])),_:1})])),_:1}),i(l,{class:"course-list"},{default:o((()=>[(r(!0),m(f,null,p(P.value,(a=>(r(),c(l,{key:a.id,class:"course-card",onClick:e=>(a=>{k({url:`/pages/course/detail?id=${a.id}`})})(a)},{default:o((()=>[i(F,{src:a.coverImage,class:"course-cover",mode:"aspectFill"},null,8,["src"]),i(l,{class:"course-info"},{default:o((()=>[i(s,{class:"course-title"},{default:o((()=>[n(d(a.title),1)])),_:2},1024),i(l,{class:"course-meta"},{default:o((()=>[i(s,{class:"course-time"},{default:o((()=>[n(d(g(E)(a.startTime)),1)])),_:2},1024),i(s,{class:"course-credit"},{default:o((()=>[n(d(a.credit)+"学分",1)])),_:2},1024)])),_:2},1024),i(l,{class:"course-status"},{default:o((()=>[i(s,{class:h(["status-tag",a.enrollStatus])},{default:o((()=>[n(d("OPEN"===a.enrollStatus?"报名中":"已截止"),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),i(H,{class:"btn-purchase",onClick:I((e=>(async a=>{"OPEN"===a.enrollStatus?z.value<a.credit?t({title:`您的个人学分不足（需要${a.credit}学分）`,icon:"none"}):w({title:"确认购买",content:`确定为 ${N.value} 购买课程《${a.title}》吗？将消耗您的 ${a.credit} 个人学分。`,success:async e=>{if(e.confirm)try{j({title:"购买中..."}),await b({toUserId:L.value,courseId:a.id}),x(),t({title:"购买成功",icon:"success"}),await O(),setTimeout((()=>{C()}),1500)}catch(s){x(),t({title:s.message||"购买失败",icon:"none"})}}}):t({title:"该课程报名已截止",icon:"none"})})(a)),["stop"])},{default:o((()=>[n(" 立即购买 ")])),_:2},1032,["onClick"])])),_:2},1032,["onClick"])))),128)),U.value||0!==P.value.length?_("",!0):(r(),c(l,{key:0,class:"empty-state"},{default:o((()=>[i(F,{src:$,class:"empty-image",mode:"aspectFit"}),i(s,{class:"empty-text"},{default:o((()=>[n("暂无可购买的课程")])),_:1})])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-99379ce8"]]);export{L as default};
