import{r as a,G as e,g as l,a0 as s,a1 as t,a2 as u,x as c,c as n,w as d,i as o,d as i,e as r,n as v,k as h,t as f,A as _,f as k,L as m,h as p,j as I,F as C,_ as y,H as g,I as E,l as b,z as w,R as D,a8 as j}from"./index-Cljxm-NV.js";import{a as x}from"./chapter.Cr41Az9z.js";import{g as H,c as z}from"./checkin.Cos8j2KI.js";import{f as $}from"./util.DiFpgDCN.js";import{C as M}from"./custom-navbar.DLfdosCP.js";import{E as Y}from"./empty-view.C6sbClhI.js";import{I as T}from"./icon.DkV2kXZZ.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";/* empty css                                                                      *//* empty css                                                                   */const F=S({__name:"chapter-detail",setup(S){const F=a(88),L=a(""),A=a(null),K=a(!1),N=a(!1),U=a(""),O=a({hasActiveSession:!1,canCheckin:!1,alreadyCheckedIn:!1,remainingMinutes:0}),R=a(0),V=a(0),B=a(0),G=a([]),P=a([]);e((a=>{console.log("ç« èŠ‚è¯¦æƒ…é¡µå‚æ•°:",a);const e=l().statusBarHeight||0;F.value=e+44,L.value=a.chapterId||a.id,L.value&&Q()})),s("evaluationSubmitted",(async()=>{console.log("ğŸ“ æ”¶åˆ°è¯„ä»·æäº¤äº‹ä»¶ï¼Œé‡æ–°åŠ è½½ç« èŠ‚è¯¦æƒ…"),await Q()})),t((()=>{u("evaluationSubmitted")}));const Q=async()=>{if(!K.value){K.value=!0;try{const a=await x(L.value);A.value=a,a._count&&(R.value=a._count.materials||0,V.value=a._count.checkinSessions||0,B.value=a._count.evaluations||0),a.materials&&(G.value=a.materials),a.checkins&&(P.value=a.checkins),await q()}catch(a){console.error("åŠ è½½ç« èŠ‚è¯¦æƒ…å¤±è´¥:",a),c({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{K.value=!1}}},q=async()=>{var a;try{const e=await H({courseId:null==(a=A.value)?void 0:a.courseId,chapterId:L.value});O.value=e}catch(e){console.error("è·å–ç­¾åˆ°ä¼šè¯å¤±è´¥:",e)}},J=async()=>{var a;if(U.value&&6===U.value.length)try{g({title:"ç­¾åˆ°ä¸­..."}),await z({courseId:null==(a=A.value)?void 0:a.courseId,chapterId:L.value,code:U.value}),E(),N.value=!1,U.value="",O.value.alreadyCheckedIn=!0,O.value.canCheckin=!1,await Q(),c({title:"ç­¾åˆ°æˆåŠŸ",icon:"success",duration:2e3})}catch(e){console.error("ç­¾åˆ°å¤±è´¥:",e),E(),c({title:e.msg||e.message||"ç­¾åˆ°å¤±è´¥",icon:"none"})}else c({title:"è¯·è¾“å…¥6ä½ç­¾åˆ°ç ",icon:"none"})},W=a=>({DRAFT:"è‰ç¨¿",PUBLISHED:"å·²å‘å¸ƒ",COMPLETED:"å·²å®Œæˆ"}[a]||"æœªçŸ¥"),X=()=>{var a,e,l,s;(null==(a=A.value)?void 0:a.hasCheckedIn)?(null==(e=A.value)?void 0:e.hasEvaluated)?b({url:`/pages/materials/list?courseId=${null==(l=A.value)?void 0:l.courseId}&chapterId=${L.value}&chapterTitle=${encodeURIComponent((null==(s=A.value)?void 0:s.title)||"")}`}):c({title:"è¯·å…ˆå®Œæˆè¯„ä»·åæŸ¥çœ‹è¯¾ä»¶",icon:"none"}):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°",icon:"none"})},Z=()=>{var a,e;(null==(a=A.value)?void 0:a.hasCheckedIn)?b({url:`/pages/evaluation/create?courseId=${null==(e=A.value)?void 0:e.courseId}&chapterId=${L.value}`}):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°",icon:"none"})},aa=()=>{var a,e,l,s;(null==(a=A.value)?void 0:a.hasCheckedIn)?(null==(e=A.value)?void 0:e.hasEvaluated)?(console.log("ğŸ“– æŸ¥çœ‹è¯„ä»·è®°å½•"),b({url:`/pages/evaluation/create?courseId=${null==(l=A.value)?void 0:l.courseId}&chapterId=${L.value}&viewMode=true`})):(console.log("ğŸ“ åˆ›å»ºè¯„ä»·"),b({url:`/pages/evaluation/create?courseId=${null==(s=A.value)?void 0:s.courseId}&chapterId=${L.value}`})):c({title:"è¯·å…ˆå®Œæˆç­¾åˆ°åå†è¯„ä»·",icon:"none"})},ea=()=>{b({url:"/pages/checkin/records"})};return(a,e)=>{const l=o,s=w,t=D,u=j;return i(),n(l,{class:"page"},{default:d((()=>{var a;return[r(M,{title:(null==(a=A.value)?void 0:a.title)||"ç« èŠ‚è¯¦æƒ…","show-back":!0},null,8,["title"]),r(l,{class:"navbar-placeholder",style:v({height:F.value+"px"})},null,8,["style"]),A.value?(i(),n(l,{key:0,class:"chapter-info-card"},{default:d((()=>[r(l,{class:"info-header"},{default:d((()=>{return[r(l,{class:"chapter-number"},{default:d((()=>[r(s,{class:"number-text"},{default:d((()=>[h("ç¬¬"+f(A.value.sortOrder)+"èŠ‚",1)])),_:1})])),_:1}),r(l,{class:_(["chapter-status",(a=A.value.status,`status-${a.toLowerCase()}`)])},{default:d((()=>[h(f(W(A.value.status)),1)])),_:1},8,["class"])];var a})),_:1}),r(l,{class:"chapter-title"},{default:d((()=>[h(f(A.value.title),1)])),_:1}),A.value.description?(i(),n(l,{key:0,class:"chapter-desc"},{default:d((()=>[h(f(A.value.description),1)])),_:1})):k("",!0),r(l,{class:"chapter-meta"},{default:d((()=>[A.value.duration?(i(),n(l,{key:0,class:"meta-item"},{default:d((()=>[r(T,{name:"time",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(A.value.duration)+"åˆ†é’Ÿ",1)])),_:1})])),_:1})):k("",!0),A.value.startTime?(i(),n(l,{key:1,class:"meta-item"},{default:d((()=>[r(T,{name:"time",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(m($)(A.value.startTime,"YYYY-MM-DD HH:mm")),1)])),_:1})])),_:1})):k("",!0),A.value.location?(i(),n(l,{key:2,class:"meta-item"},{default:d((()=>[r(T,{name:"location",size:28,color:"#999"}),r(s,null,{default:d((()=>[h(f(A.value.location),1)])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})):k("",!0),A.value?(i(),n(l,{key:1,class:"action-section"},{default:d((()=>[O.value.canCheckin&&!O.value.alreadyCheckedIn?(i(),n(t,{key:0,class:"btn-checkin",onClick:e[0]||(e[0]=a=>N.value=!0)},{default:d((()=>[r(T,{name:"check",size:32,color:"#fff"}),r(s,null,{default:d((()=>[h("ç«‹å³ç­¾åˆ°ï¼ˆå‰©ä½™"+f(O.value.remainingMinutes)+"åˆ†é’Ÿï¼‰",1)])),_:1})])),_:1})):O.value.alreadyCheckedIn?(i(),n(t,{key:1,class:"btn-checked-in",disabled:""},{default:d((()=>[r(T,{name:"check",size:32,color:"#fff"}),r(s,null,{default:d((()=>[h("å·²ç­¾åˆ°")])),_:1})])),_:1})):k("",!0),O.value.alreadyCheckedIn&&!A.value.hasEvaluated?(i(),n(t,{key:2,class:"btn-evaluate",onClick:Z},{default:d((()=>[r(s,null,{default:d((()=>[h("â­ è¯„ä»·æœ¬èŠ‚")])),_:1})])),_:1})):O.value.alreadyCheckedIn&&A.value.hasEvaluated?(i(),n(t,{key:3,class:"btn-evaluated",disabled:""},{default:d((()=>[r(s,null,{default:d((()=>[h("â­ å·²è¯„ä»·")])),_:1})])),_:1})):k("",!0)])),_:1})):k("",!0),r(l,{class:"function-section"},{default:d((()=>[r(l,{class:"section-title"},{default:d((()=>[h("ç« èŠ‚å†…å®¹")])),_:1}),r(l,{class:"function-grid"},{default:d((()=>{var a,e,s,t,u,c;return[r(l,{class:_(["function-card",[(null==(a=A.value)?void 0:a.hasCheckedIn)?"card-success":"card-default",(null==(e=A.value)?void 0:e.hasCheckedIn)?"":"card-locked"]]),onClick:ea},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e;return[r(T,{name:(null==(a=A.value)?void 0:a.hasCheckedIn)?"check":"clock-o",size:64,color:(null==(e=A.value)?void 0:e.hasCheckedIn)?"#52C41A":"#999"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("ç­¾åˆ°è®°å½•")])),_:1}),r(l,{class:_(["card-status",(null==(a=A.value)?void 0:a.hasCheckedIn)?"status-success":"status-default"])},{default:d((()=>{var a;return[h(f((null==(a=A.value)?void 0:a.hasCheckedIn)?"å·²ç­¾åˆ°":"æœªç­¾åˆ°"),1)]})),_:1},8,["class"]),(null==(e=A.value)?void 0:e.hasCheckedIn)?k("",!0):(i(),n(l,{key:0,class:"card-tip"},{default:d((()=>[h("è¯·å…ˆç­¾åˆ°")])),_:1}))]})),_:1},8,["class"]),r(l,{class:_(["function-card",[(null==(s=A.value)?void 0:s.hasEvaluated)?"card-success":"card-default",(null==(t=A.value)?void 0:t.hasCheckedIn)?"":"card-locked"]]),onClick:aa},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e,l,s;return[r(T,{name:(null==(a=A.value)?void 0:a.hasEvaluated)?"star":(null==(e=A.value)?void 0:e.hasCheckedIn)?"star-o":"lock",size:64,color:(null==(l=A.value)?void 0:l.hasEvaluated)?"#FF9800":(null==(s=A.value)?void 0:s.hasCheckedIn)?"#999":"#ccc"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("è¯¾ç¨‹è¯„ä»·")])),_:1}),r(l,{class:_(["card-status",(null==(a=A.value)?void 0:a.hasEvaluated)?"status-success":"status-default"])},{default:d((()=>{var a,e;return[h(f((null==(a=A.value)?void 0:a.hasEvaluated)?"å·²è¯„ä»·":(null==(e=A.value)?void 0:e.hasCheckedIn)?"æœªè¯„ä»·":"å·²é”å®š"),1)]})),_:1},8,["class"]),(null==(e=A.value)?void 0:e.hasCheckedIn)?k("",!0):(i(),n(l,{key:0,class:"card-tip"},{default:d((()=>[h("ç­¾åˆ°åè§£é”")])),_:1}))]})),_:1},8,["class"]),r(l,{class:_(["function-card",[(null==(u=A.value)?void 0:u.hasEvaluated)?"card-success":"card-default",(null==(c=A.value)?void 0:c.hasEvaluated)?"":"card-locked"]]),onClick:X},{default:d((()=>{var a,e;return[r(l,{class:"card-icon"},{default:d((()=>{var a,e;return[r(T,{name:(null==(a=A.value)?void 0:a.hasEvaluated)?"course":"lock",size:64,color:(null==(e=A.value)?void 0:e.hasEvaluated)?"#C8161D":"#ccc"},null,8,["name","color"])]})),_:1}),r(l,{class:"card-title"},{default:d((()=>[h("è¯¾ä»¶èµ„æ–™")])),_:1}),(null==(a=A.value)?void 0:a.hasEvaluated)?(i(),n(l,{key:0,class:"card-count"},{default:d((()=>[h(f(R.value)+"ä»½",1)])),_:1})):(i(),n(l,{key:1,class:"card-status status-default"},{default:d((()=>[h("å·²é”å®š")])),_:1})),(null==(e=A.value)?void 0:e.hasEvaluated)?k("",!0):(i(),n(l,{key:2,class:"card-tip"},{default:d((()=>[h("è¯„ä»·åè§£é”")])),_:1}))]})),_:1},8,["class"])]})),_:1})])),_:1}),P.value.length>0?(i(),n(l,{key:2,class:"checkins-section"},{default:d((()=>[r(l,{class:"section-header"},{default:d((()=>[r(s,{class:"section-title"},{default:d((()=>[h("ç­¾åˆ°è®°å½•")])),_:1}),r(s,{class:"section-more"},{default:d((()=>[h("æŸ¥çœ‹å…¨éƒ¨")])),_:1})])),_:1}),(i(!0),p(C,null,I(P.value.slice(0,3),(a=>(i(),n(l,{key:a.id,class:"checkin-item"},{default:d((()=>[r(l,{class:_(["checkin-status","CHECKED_IN"===a.status?"checked":"missed"])},{default:d((()=>[r(T,{name:"CHECKED_IN"===a.status?"check":"close",size:32,color:"#fff"},null,8,["name"])])),_:2},1032,["class"]),r(l,{class:"checkin-info"},{default:d((()=>[r(l,{class:"checkin-title"},{default:d((()=>[h("ç­¾åˆ°ç : "+f(a.code),1)])),_:2},1024),r(l,{class:"checkin-time"},{default:d((()=>[h(f(m($)(a.checkinTime,"YYYY-MM-DD HH:mm")),1)])),_:2},1024)])),_:2},1024),r(l,{class:_(["checkin-badge","CHECKED_IN"===a.status?"success":"error"])},{default:d((()=>[h(f("CHECKED_IN"===a.status?"å·²ç­¾åˆ°":"ç¼ºå‹¤"),1)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})):k("",!0),K.value||A.value?k("",!0):(i(),n(Y,{key:3,text:"ç« èŠ‚ä¿¡æ¯åŠ è½½å¤±è´¥"})),K.value?(i(),n(l,{key:4,class:"loading-container"},{default:d((()=>[r(s,{class:"loading-text"},{default:d((()=>[h("åŠ è½½ä¸­...")])),_:1})])),_:1})):k("",!0),N.value?(i(),n(l,{key:5,class:"modal-overlay",onClick:e[4]||(e[4]=a=>N.value=!1)},{default:d((()=>[r(l,{class:"checkin-modal",onClick:e[3]||(e[3]=y((()=>{}),["stop"]))},{default:d((()=>[r(l,{class:"modal-title"},{default:d((()=>[h("ç« èŠ‚ç­¾åˆ°")])),_:1}),r(l,{class:"modal-subtitle"},{default:d((()=>[h("è¯·è¾“å…¥è€å¸ˆå‘ŠçŸ¥çš„6ä½æ•°å­—ç­¾åˆ°ç ")])),_:1}),r(l,{class:"code-input-section"},{default:d((()=>[r(u,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),type:"number",maxlength:"6",placeholder:"è¯·è¾“å…¥6ä½ç­¾åˆ°ç ",class:"code-input",onConfirm:J},null,8,["modelValue"]),r(t,{class:"btn-submit-code",onClick:J},{default:d((()=>[h("ç«‹å³ç­¾åˆ°")])),_:1})])),_:1}),r(t,{class:"btn-cancel",onClick:e[2]||(e[2]=a=>N.value=!1)},{default:d((()=>[h(" å–æ¶ˆ ")])),_:1})])),_:1})])),_:1})):k("",!0)]})),_:1})}}},[["__scopeId","data-v-a5d5dd4d"]]);export{F as default};
