import{u as a,r as e,z as l,B as s,C as t,X as c,D as u,m as d,c as i,w as o,i as n,d as r,e as f,k as _,t as v,H as m,v as p,N as g,a9 as h,ae as b,p as x,q as w,a2 as C,af as I,T as V}from"./index-BA-OeFd4.js";import{a as y}from"./course-gift.BX61b_Xf.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=D({__name:"create",setup(D){const j=a(),U=e(""),k=e({title:"",coverImage:"",credit:0}),q=e(""),T=e(""),$=e(!1),z=l((()=>j.remainingCredits-(k.value.credit||0))),B=l((()=>q.value&&z.value>=0));s((async a=>{U.value=a.courseId;try{t({title:"加载中..."});const a=await c(U.value);k.value=a,await j.fetchCredits(),u()}catch(e){u(),d({title:e.msg||"加载失败",icon:"none"})}}));const F=async()=>{q.value?z.value<0?d({title:"学分不足",icon:"none"}):g({title:"确认赠送",content:`将消耗 ${k.value.credit} 学分赠送课程《${k.value.title}》给对方，确认吗？`,success:async a=>{if(a.confirm)try{$.value=!0,await y({courseId:U.value,toUser:q.value,message:T.value}),$.value=!1,g({title:"赠送成功",content:"课程已成功赠送给对方，对方将收到通知。",showCancel:!1,success:()=>{h({delta:1,success:()=>{b("refreshCourseDetail")}})}})}catch(e){$.value=!1,d({title:e.msg||"赠送失败",icon:"none"})}}}):d({title:"请输入接收方",icon:"none"})};return(a,e)=>{const l=x,s=w,t=n,c=C,u=I,d=V;return r(),i(t,{class:"page"},{default:o((()=>[f(t,{class:"course-card"},{default:o((()=>[f(l,{src:k.value.coverImage,class:"cover",mode:"aspectFill"},null,8,["src"]),f(t,{class:"course-info"},{default:o((()=>[f(s,{class:"title"},{default:o((()=>[_(v(k.value.title),1)])),_:1}),f(t,{class:"credit-badge"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("消耗学分")])),_:1}),f(s,{class:"value"},{default:o((()=>[_(v(k.value.credit),1)])),_:1})])),_:1})])),_:1})])),_:1}),f(t,{class:"form-section"},{default:o((()=>[f(t,{class:"section-title"},{default:o((()=>[_("赠送信息")])),_:1}),f(t,{class:"form-item required"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("接收方")])),_:1}),f(c,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),placeholder:"请输入对方的手机号或用户ID","placeholder-class":"placeholder"},null,8,["modelValue"]),f(s,{class:"tip"},{default:o((()=>[_("可输入手机号或用户ID")])),_:1})])),_:1}),f(t,{class:"form-item"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("赠送留言")])),_:1}),f(u,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),placeholder:"给对方留言（可选）","placeholder-class":"placeholder",maxlength:100},null,8,["modelValue"]),f(t,{class:"char-count"},{default:o((()=>[_(v(T.value.length)+"/100",1)])),_:1})])),_:1})])),_:1}),f(t,{class:"balance-section"},{default:o((()=>[f(t,{class:"balance-item current"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("当前学分")])),_:1}),f(s,{class:"value"},{default:o((()=>[_(v(m(j).remainingCredits),1)])),_:1})])),_:1}),f(t,{class:"balance-arrow"},{default:o((()=>[_("→")])),_:1}),f(t,{class:"balance-item after"},{default:o((()=>[f(s,{class:"label"},{default:o((()=>[_("赠送后剩余")])),_:1}),f(s,{class:p(["value",{insufficient:z.value<0}])},{default:o((()=>[_(v(z.value),1)])),_:1},8,["class"])])),_:1})])),_:1}),f(t,{class:"tip-section"},{default:o((()=>[f(t,{class:"tip-title"},{default:o((()=>[_("赠送说明")])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("赠送后立即生效，对方将自动报名该课程")])),_:1})])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_('赠送记录可在"个人中心-赠送记录"中查看')])),_:1})])),_:1}),f(t,{class:"tip-item"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("✓")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("老师可查看赠送记录，了解课程来源")])),_:1})])),_:1}),f(t,{class:"tip-item warning"},{default:o((()=>[f(s,{class:"icon"},{default:o((()=>[_("!")])),_:1}),f(s,{class:"text"},{default:o((()=>[_("赠送的课程对方不能退课")])),_:1})])),_:1})])),_:1}),f(t,{class:"footer"},{default:o((()=>[f(d,{class:"btn-submit",onClick:F,disabled:!B.value,loading:$.value},{default:o((()=>[_(" 确认赠送 ")])),_:1},8,["disabled","loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-7fd24748"]]);export{j as default};
