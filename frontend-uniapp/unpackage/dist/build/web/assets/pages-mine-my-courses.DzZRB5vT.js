import{r as e,o as a,a5 as l,m as s,s as t,b as u,A as o,c as r,w as n,i as c,d as i,e as d,h as v,j as _,F as p,n as m,f,k as y,q as h,v as b,t as g,l as w,N as k}from"./index-BA-OeFd4.js";import{C as j}from"./course-card.3HxFFqMZ.js";import{E as C}from"./empty-view.BTAzOfaH.js";import{I as x}from"./icon.DZSIreks.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./util.SBHl27LX.js";/* empty css                                                                    *//* empty css                                                                   */const $=I({__name:"my-courses",setup(I){const $=[{label:"进行中",value:"enrolled",icon:"course"},{label:"已完成",value:"completed",icon:"check"}],A=e("enrolled"),D=e([]),T=e(!1),q=e(1),E=e(10),F=e(!0);a((()=>{M(!0)}));const M=async(e=!1)=>{if(!T.value){T.value=!0,e&&(q.value=1,F.value=!0);try{const a=await l(A.value);let s=[];if(Array.isArray(a))s=a.map((e=>e.course)).filter((e=>null!==e));else{s=(a.items||a.data||a.list||[]).map((e=>e.course)).filter((e=>null!==e))}D.value=e?s:[...D.value,...s],s.length<E.value&&(F.value=!1),q.value++}catch(a){console.error("加载课程列表失败：",a),s({title:"加载失败",icon:"none"})}finally{T.value=!1,e&&t()}}},N=e=>{w({url:`/pages/course/detail?id=${e.id}`})},R=e=>{w({url:`/pages/course/chapters?courseId=${e.id}&courseTitle=${encodeURIComponent(e.title)}`})},z=e=>{const a=new Date(e.startTime).getTime(),l=Date.now(),s=Math.ceil((a-l)/864e5);s<=3?k({title:"无法退课",content:`开课前3天内不能申请退课，当前距离开课还有${s}天`,showCancel:!1}):w({url:`/pages/refund-request/create?courseId=${e.id}`})};return u((()=>{M(!0)})),o((()=>{F.value&&!T.value&&M(!1)})),(e,a)=>{const l=h,s=c;return i(),r(s,{class:"page"},{default:n((()=>[d(s,{class:"status-tabs"},{default:n((()=>[d(s,{class:"tabs-container"},{default:n((()=>[(i(),v(p,null,_($,(e=>d(s,{key:e.value,class:b(["tab-item",{active:A.value===e.value}]),onClick:a=>{return l=e.value,void(A.value!==l&&(A.value=l,M(!0)));var l}},{default:n((()=>[d(x,{name:e.icon,size:36,color:A.value===e.value?"#C8161D":"#999"},null,8,["name","color"]),d(l,{class:"tab-label"},{default:n((()=>[y(g(e.label),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64)),d(s,{class:"tab-indicator",style:m({left:"enrolled"===A.value?"0":"50%"})},null,8,["style"])])),_:1})])),_:1}),d(s,{class:"course-list"},{default:n((()=>[(i(!0),v(p,null,_(D.value,(e=>(i(),r(j,{key:e.id,course:e,"show-refund-button":"enrolled"===A.value,"show-chapter-button":"enrolled"===A.value,onClick:N,onRefund:z,onViewChapters:R},null,8,["course","show-refund-button","show-chapter-button"])))),128)),T.value||0!==D.value.length?f("",!0):(i(),r(C,{key:0,text:"暂无课程"})),T.value?(i(),r(s,{key:1,class:"loading-more"},{default:n((()=>[d(l,null,{default:n((()=>[y("加载中...")])),_:1})])),_:1})):f("",!0),!F.value&&D.value.length>0?(i(),r(s,{key:2,class:"no-more"},{default:n((()=>[d(l,null,{default:n((()=>[y("没有更多了")])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-3bd35e00"]]);export{$ as default};
