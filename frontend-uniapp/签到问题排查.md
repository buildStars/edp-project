# ç­¾åˆ°åŠŸèƒ½é—®é¢˜æ’æŸ¥

## é—®é¢˜æè¿°
åç«¯è¿”å›äº†æˆåŠŸçš„æ•°æ®ï¼Œä½†å‰ç«¯æ˜¾ç¤º"ç­¾åˆ°å¤±è´¥"ã€‚

### åç«¯è¿”å›æ•°æ®
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "success": true,
    "message": "ç­¾åˆ°æˆåŠŸ",
    "checkinTime": "2025-11-11T15:36:35.664Z",
    "courseName": "é¢†å¯¼åŠ›æå‡ä¸å›¢é˜Ÿç®¡ç†"
  }
}
```

## é—®é¢˜åˆ†æ

### 1. å“åº”æ‹¦æˆªå™¨é€»è¾‘
æ–‡ä»¶ï¼š`frontend-uniapp/api/request.js`

```javascript
if (data.code === 200 || data.code === 0) {
  resolve(data.data)  // è¿”å› data.data
} else {
  reject({ ...data, msg: data.msg || data.message || 'è¯·æ±‚å¤±è´¥' })
}
```

æ‰€ä»¥ `checkinByCode` è¿”å›çš„åº”è¯¥æ˜¯ï¼š
```javascript
{
  "success": true,
  "message": "ç­¾åˆ°æˆåŠŸ",
  "checkinTime": "2025-11-11T15:36:35.664Z",
  "courseName": "é¢†å¯¼åŠ›æå‡ä¸å›¢é˜Ÿç®¡ç†"
}
```

### 2. å‰ç«¯è°ƒç”¨ä»£ç 
æ–‡ä»¶ï¼š`frontend-uniapp/pages/course/detail.vue` (ç¬¬427-446è¡Œ)

```javascript
try {
  uni.showLoading({ title: 'ç­¾åˆ°ä¸­...' })
  const result = await checkinByCode({
    courseId: courseId.value,
    code: checkinCode.value
  })
  
  uni.hideLoading()
  uni.showToast({ title: result.message, icon: 'success' })  // åº”è¯¥æ˜¾ç¤º "ç­¾åˆ°æˆåŠŸ"
  
  // ... å…¶ä»–é€»è¾‘
} catch (error) {
  uni.hideLoading()
  uni.showToast({ title: error.msg || 'ç­¾åˆ°å¤±è´¥', icon: 'none' })  // æ˜¾ç¤º "ç­¾åˆ°å¤±è´¥"
}
```

## å¯èƒ½çš„åŸå› 

### åŸå› 1ï¼šä»£ç æ‰§è¡Œè¿›å…¥äº† catch å—
å¦‚æœè¯·æ±‚è¢« reject äº†ï¼Œå°±ä¼šè¿›å…¥ catch å—ã€‚

**æ£€æŸ¥ç‚¹ï¼š**
1. å“åº”æ‹¦æˆªå™¨çš„åˆ¤æ–­é€»è¾‘æ˜¯å¦æ­£ç¡®
2. `data.code` æ˜¯å¦ä¸¥æ ¼ç­‰äº 200ï¼ˆç±»å‹æ£€æŸ¥ï¼‰
3. æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹æŠ›å‡ºäº†å¼‚å¸¸

### åŸå› 2ï¼šç±»å‹ä¸åŒ¹é…
å¦‚æœ `data.code` æ˜¯å­—ç¬¦ä¸² `"200"`ï¼Œè€Œåˆ¤æ–­ç”¨çš„æ˜¯ `=== 200`ï¼ˆæ•°å­—ï¼‰ï¼Œä¼šå¯¼è‡´åˆ¤æ–­å¤±è´¥ã€‚

**ä¿®å¤ï¼š**
```javascript
if (data.code == 200 || data.code == 0) {  // ä½¿ç”¨ == è€Œä¸æ˜¯ ===
  resolve(data.data)
} else {
  reject({ ...data, msg: data.msg || data.message || 'è¯·æ±‚å¤±è´¥' })
}
```

### åŸå› 3ï¼šåç»­ä»£ç æ‰§è¡Œå‡ºé”™
å³ä½¿ç­¾åˆ°æˆåŠŸï¼Œå¦‚æœåç»­ä»£ç ï¼ˆå¦‚ `fetchActiveCheckinSession()`ï¼‰å‡ºé”™ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´é—®é¢˜ã€‚

## å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—ï¼ˆæ¨èå…ˆåšï¼‰

åœ¨ `frontend-uniapp/pages/course/detail.vue` çš„ç­¾åˆ°ä»£ç ä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
const submitCode = async () => {
  if (!checkinCode.value || checkinCode.value.length !== 6) {
    uni.showToast({ title: 'è¯·è¾“å…¥6ä½ç­¾åˆ°ç ', icon: 'none' })
    return
  }
  
  try {
    uni.showLoading({ title: 'ç­¾åˆ°ä¸­...' })
    console.log('ğŸ“¤ å‘èµ·ç­¾åˆ°è¯·æ±‚:', {
      courseId: courseId.value,
      code: checkinCode.value
    })
    
    const result = await checkinByCode({
      courseId: courseId.value,
      code: checkinCode.value
    })
    
    console.log('âœ… ç­¾åˆ°æˆåŠŸï¼Œè¿”å›æ•°æ®:', result)
    uni.hideLoading()
    uni.showToast({ title: result.message || 'ç­¾åˆ°æˆåŠŸ', icon: 'success' })
    
    // å…³é—­å¼¹çª—å¹¶åˆ·æ–°çŠ¶æ€
    checkinPopup.value.close()
    checkinSession.value.alreadyCheckedIn = true
    checkinSession.value.canCheckin = false
    showCodeInput.value = false
    checkinCode.value = ''
    
    // å»¶è¿Ÿåˆ·æ–°ï¼Œé¿å…å†²çª
    setTimeout(() => {
      fetchActiveCheckinSession()
    }, 500)
    
  } catch (error) {
    console.error('âŒ ç­¾åˆ°å¤±è´¥:', error)
    uni.hideLoading()
    uni.showToast({ 
      title: error.msg || error.message || 'ç­¾åˆ°å¤±è´¥', 
      icon: 'none' 
    })
  }
}
```

### æ–¹æ¡ˆ2ï¼šä¿®å¤ç±»å‹åˆ¤æ–­

åœ¨ `frontend-uniapp/api/request.js` ä¸­ä¿®æ”¹åˆ¤æ–­é€»è¾‘ï¼š

```javascript
// å°†ä¸¥æ ¼ç›¸ç­‰æ”¹ä¸ºå®½æ¾ç›¸ç­‰
if (data.code == 200 || data.code == 0) {
  resolve(data.data)
} else {
  reject({ ...data, msg: data.msg || data.message || 'è¯·æ±‚å¤±è´¥' })
}
```

### æ–¹æ¡ˆ3ï¼šå¢å¼ºé”™è¯¯ä¿¡æ¯

ä¿®æ”¹ catch å—ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

```javascript
catch (error) {
  console.error('âŒ ç­¾åˆ°å¤±è´¥:', error)
  uni.hideLoading()
  
  let errorMsg = 'ç­¾åˆ°å¤±è´¥'
  if (error.msg) {
    errorMsg = error.msg
  } else if (error.message) {
    errorMsg = error.message
  } else if (typeof error === 'string') {
    errorMsg = error
  }
  
  uni.showToast({ title: errorMsg, icon: 'none' })
}
```

## æµ‹è¯•æ­¥éª¤

1. **æ·»åŠ æ—¥å¿—**ï¼šåœ¨ç­¾åˆ°ä»£ç ä¸­æ·»åŠ  console.log
2. **æ¸…é™¤ç¼“å­˜**ï¼šé‡æ–°ç¼–è¯‘å°ç¨‹åº
3. **æµ‹è¯•ç­¾åˆ°**ï¼šè¿›è¡Œç­¾åˆ°æ“ä½œ
4. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   - æ‰“å¼€å¼€å‘è€…å·¥å…·çš„ Console
   - æŸ¥çœ‹è¯·æ±‚å’Œå“åº”æ•°æ®
   - ç¡®è®¤ä»£ç æ‰§è¡Œè·¯å¾„ï¼ˆæ˜¯è¿›å…¥ try è¿˜æ˜¯ catchï¼‰

## é¢„æœŸç»“æœ

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ“¤ å‘èµ·ç­¾åˆ°è¯·æ±‚: { courseId: "xxx", code: "123456" }
âœ… ç­¾åˆ°æˆåŠŸï¼Œè¿”å›æ•°æ®: { success: true, message: "ç­¾åˆ°æˆåŠŸ", ... }
```

å¦‚æœæœ‰é—®é¢˜ï¼Œä¼šçœ‹åˆ°ï¼š
```
âŒ ç­¾åˆ°å¤±è´¥: { ... }
```

æ ¹æ®é”™è¯¯ä¿¡æ¯å¯ä»¥è¿›ä¸€æ­¥å®šä½é—®é¢˜ã€‚


