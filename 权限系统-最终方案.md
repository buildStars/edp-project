# æƒé™ç³»ç»Ÿ - æœ€ç»ˆæ–¹æ¡ˆ

## ğŸ“Œ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1ï¸âƒ£ å”¯ä¸€æƒé™é…ç½®æº
**åç«¯ `menu.config.ts`** æ˜¯æƒé™ç³»ç»Ÿçš„**å”¯ä¸€é…ç½®æº**ï¼Œå‰ç«¯å®Œå…¨ä»åç«¯è·å–ã€‚

### 2ï¸âƒ£ èœå•é©±åŠ¨æƒé™
- æ¯ä¸ªèœå•é¡¹éƒ½æœ‰**å”¯ä¸€çš„æƒé™ä»£ç **
- æƒé™å‘½åè§„èŒƒï¼š`module:action`
- çˆ¶å­èœå•æƒé™**å¿…é¡»ä¸åŒ**ï¼Œé¿å…å†²çª

### 3ï¸âƒ£ æƒé™ç»§æ‰¿æœºåˆ¶
- æ‹¥æœ‰ `module:view` â†’ è‡ªåŠ¨æ‹¥æœ‰ `module:create`ã€`module:edit`ã€`module:delete` ç­‰
- ç®¡ç†å‘˜åªéœ€é…ç½®èœå•æƒé™ï¼Œå‰ç«¯æŒ‰é’®è‡ªåŠ¨é€‚é…

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯èœå•é…ç½®è§„èŒƒåŒ–

**æ–‡ä»¶**: `backend/src/modules/permissions/menu.config.ts`

**ä¿®å¤å†…å®¹**: ç¡®ä¿æ¯ä¸ªèœå•é¡¹éƒ½æœ‰å”¯ä¸€çš„æƒé™ä»£ç 

#### ä¿®æ”¹å‰ï¼ˆæœ‰é—®é¢˜ï¼‰
```typescript
{
  title: 'ç³»ç»Ÿè®¾ç½®',
  permission: 'settings:view',  // çˆ¶çº§
  children: [
    { title: 'åŸºç¡€è®¾ç½®', permission: 'settings:view' },  // âŒ é‡å¤
    { title: 'AIé…ç½®', permission: 'settings:view' },     // âŒ é‡å¤
  ]
}
```

#### ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
```typescript
{
  title: 'ç³»ç»Ÿè®¾ç½®',
  permission: 'settings:view',  // çˆ¶çº§èœå•
  children: [
    { title: 'åŸºç¡€è®¾ç½®', permission: 'settings:basic' },     // âœ… å”¯ä¸€
    { title: 'AIé…ç½®', permission: 'settings:ai-config' },   // âœ… å”¯ä¸€
  ]
}
```

#### æ‰€æœ‰ä¿®æ”¹
| èœå• | å­èœå• | åŸæƒé™ | æ–°æƒé™ |
|------|--------|--------|--------|
| èµ„è®¯ç®¡ç† | èµ„è®¯åˆ—è¡¨ | `news:view` | `news:list` |
| æ ¡å‹ç”Ÿæ´» | åä¼šåˆ—è¡¨ | `associations:view` | `associations:list` |
| è¯¾ç¨‹ç®¡ç† | è¯¾ç¨‹åˆ—è¡¨ | `courses:view` | `courses:list` |
| ç”¨æˆ·ç®¡ç† | ç”¨æˆ·åˆ—è¡¨ | `users:view` | `users:list` |
| ä¼ä¸šç®¡ç† | ä¼ä¸šåˆ—è¡¨ | `organizations:view` | `organizations:list` |
| æŠ¥åç®¡ç† | è¯¾ç¨‹æŠ¥å | `enrollments:view` | `enrollments:list` |
| è¯¾ä»¶ç®¡ç† | è¯¾ä»¶åˆ—è¡¨ | `courseware:view` | `courseware:list` |
| æˆ‘çš„è¯¾ç¨‹ | è¯¾ç¨‹åˆ—è¡¨ | `my-courses:view` | `my-courses:list` |
| ç³»ç»Ÿè®¾ç½® | åŸºç¡€è®¾ç½® | `settings:view` | `settings:basic` |
| ç³»ç»Ÿè®¾ç½® | AIé…ç½® | `settings:view` | `settings:ai-config` |

### 2. æƒé™ç§å­æ–‡ä»¶æ›´æ–°

**æ–‡ä»¶**: `backend/prisma/seeds/permissions.seed.ts`

**æ–°å¢æƒé™**: 
- `news:list`
- `associations:list`
- `activities:view` (é‡å‘½å)
- `courses:list`
- `users:list`
- `organizations:list`
- `enrollments:list`
- `course-gifts:view`
- `evaluations:view`
- `courseware:list`
- `settings:basic`
- `settings:ai-config`
- `my-courses:list`

**æƒé™æ€»æ•°**: 81 ä¸ªï¼ˆä¹‹å‰æ˜¯ 68 ä¸ªï¼‰

### 3. è§’è‰²æƒé™é…ç½®æ›´æ–°

| è§’è‰² | æƒé™æ•°é‡ |
|------|---------|
| ADMIN | 79 ä¸ª |
| STAFF | 74 ä¸ª |
| TEACHER | 40 ä¸ª |
| ADVISOR | 11 ä¸ª |
| STUDENT | 0 ä¸ª |

### 4. å‰ç«¯æƒé™æŒ‡ä»¤å¢å¼º

**æ–‡ä»¶**: `admin-frontend/src/directives/permission.ts`

**åŠŸèƒ½**: æ”¯æŒæ¨¡å—çº§æƒé™ç»§æ‰¿

```typescript
// ç¤ºä¾‹ï¼šç”¨æˆ·æœ‰ news:view æƒé™
v-permission="'news:create'"  // âœ… è‡ªåŠ¨é€šè¿‡ï¼ˆç»§æ‰¿è‡ª news:viewï¼‰
v-permission="'news:edit'"    // âœ… è‡ªåŠ¨é€šè¿‡
v-permission="'news:delete'"  // âœ… è‡ªåŠ¨é€šè¿‡
```

### 5. æƒé™é…ç½®é¡µé¢ä¼˜åŒ–

**æ–‡ä»¶**: `admin-frontend/src/views/Settings/Roles.vue`

**æ”¹è¿›**:
- âœ… ä»åç«¯ `GET /permissions/menus` è·å–èœå•é…ç½®
- âœ… è‡ªåŠ¨ç”Ÿæˆæƒé™æ ‘ï¼ˆå®Œå…¨åŸºäºåç«¯èœå•ï¼‰
- âœ… ä¿å­˜åä¸å†è¿‡æ»¤æƒé™ï¼ˆè§£å†³å–æ¶ˆå‹¾é€‰å¤±æ•ˆçš„é—®é¢˜ï¼‰

## ğŸ¯ ä½¿ç”¨æµç¨‹

### ç®¡ç†å‘˜é…ç½®æƒé™

1. **æ‰“å¼€æƒé™é…ç½®é¡µé¢**
   - è®¿é—® http://localhost:3001/settings/roles
   - é€‰æ‹©è¦é…ç½®çš„è§’è‰²ï¼ˆå¦‚"æ•™å¸ˆ"ï¼‰

2. **å‹¾é€‰èœå•æƒé™**
   - âœ… é¦–é¡µæ¦‚è§ˆ
   - âœ… è¯¾ç¨‹ç®¡ç†
     - âœ… è¯¾ç¨‹åˆ—è¡¨
   - âœ… ç”¨æˆ·ç®¡ç†
     - âœ… ç”¨æˆ·åˆ—è¡¨
     - âœ… è¯¾ç¨‹é¡¾é—®
   - ... ç­‰ç­‰

3. **ç‚¹å‡»ä¿å­˜**
   - ç³»ç»Ÿä¼šä¿å­˜æ‰€æœ‰å‹¾é€‰çš„æƒé™
   - åŒ…æ‹¬çˆ¶çº§èœå•æƒé™å’Œå­çº§é¡µé¢æƒé™

4. **ç”¨æˆ·é‡æ–°ç™»å½•**
   - æ–°æƒé™ç«‹å³ç”Ÿæ•ˆ
   - å‰ç«¯èœå•å’ŒæŒ‰é’®è‡ªåŠ¨é€‚é…

### æƒé™ç»§æ‰¿ç¤ºä¾‹

**åœºæ™¯**: ç»™æ•™å¸ˆé…ç½®äº† `courses:view` èœå•æƒé™

**ç»“æœ**:
- âœ… èƒ½çœ‹åˆ°"è¯¾ç¨‹ç®¡ç†"èœå•ï¼ˆ`courses:view`ï¼‰
- âœ… èƒ½çœ‹åˆ°"æ–°å¢è¯¾ç¨‹"æŒ‰é’®ï¼ˆ`courses:create` ç»§æ‰¿è‡ª `courses:view`ï¼‰
- âœ… èƒ½çœ‹åˆ°"ç¼–è¾‘"æŒ‰é’®ï¼ˆ`courses:edit` ç»§æ‰¿è‡ª `courses:view`ï¼‰
- âœ… èƒ½çœ‹åˆ°"åˆ é™¤"æŒ‰é’®ï¼ˆ`courses:delete` ç»§æ‰¿è‡ª `courses:view`ï¼‰

## ğŸ”§ æƒé™å‘½åè§„èŒƒ

### çˆ¶çº§èœå•æƒé™
æ ¼å¼: `module:view`

ç¤ºä¾‹:
- `news:view` - èµ„è®¯ç®¡ç†
- `courses:view` - è¯¾ç¨‹ç®¡ç†
- `users:view` - ç”¨æˆ·ç®¡ç†

### å­çº§é¡µé¢æƒé™
æ ¼å¼: `module:page-name` æˆ– `module:specific-action`

ç¤ºä¾‹:
- `news:list` - èµ„è®¯åˆ—è¡¨é¡µé¢
- `courses:list` - è¯¾ç¨‹åˆ—è¡¨é¡µé¢
- `settings:basic` - åŸºç¡€è®¾ç½®é¡µé¢
- `settings:ai-config` - AIé…ç½®é¡µé¢

### æ“ä½œæƒé™
æ ¼å¼: `module:action`

ç¤ºä¾‹:
- `news:create` - åˆ›å»ºèµ„è®¯
- `courses:edit` - ç¼–è¾‘è¯¾ç¨‹
- `users:delete` - åˆ é™¤ç”¨æˆ·

### âš ï¸ é‡è¦åŸåˆ™
- **æ¯ä¸ªèœå•é¡¹å¿…é¡»æœ‰å”¯ä¸€çš„æƒé™ä»£ç **
- **é¿å…çˆ¶å­èœå•ä½¿ç”¨ç›¸åŒçš„æƒé™ä»£ç **
- **æƒé™å‘½åè¦è§åçŸ¥ä¹‰**

## ğŸ“ ç»´æŠ¤æµç¨‹

### æ·»åŠ æ–°èœå•

1. **ä¿®æ”¹èœå•é…ç½®** (`backend/menu.config.ts`)
```typescript
{
  path: '/new-menu',
  title: 'æ–°åŠŸèƒ½',
  permission: 'new-feature:view',
  children: [
    {
      path: '/new-menu/list',
      title: 'åŠŸèƒ½åˆ—è¡¨',
      permission: 'new-feature:list',  // âœ… å”¯ä¸€çš„æƒé™ä»£ç 
    }
  ]
}
```

2. **æ·»åŠ æƒé™å®šä¹‰** (`backend/prisma/seeds/permissions.seed.ts`)
```typescript
{ code: 'new-feature:view', name: 'æ–°åŠŸèƒ½', description: 'æ–°åŠŸèƒ½èœå•', module: 'new-feature' },
{ code: 'new-feature:list', name: 'åŠŸèƒ½åˆ—è¡¨', description: 'æŸ¥çœ‹åŠŸèƒ½åˆ—è¡¨', module: 'new-feature' },
{ code: 'new-feature:create', name: 'åˆ›å»º', description: 'åˆ›å»ºæ–°åŠŸèƒ½', module: 'new-feature' },
```

3. **é…ç½®è§’è‰²æƒé™** (`backend/prisma/seeds/permissions.seed.ts`)
```typescript
ADMIN: [
  // ... å…¶ä»–æƒé™
  'new-feature:view', 'new-feature:list', 'new-feature:create',
],
```

4. **é‡æ–°åˆå§‹åŒ–æƒé™**
```bash
cd backend
npm run seed:permissions:force
```

5. **å‰ç«¯è‡ªåŠ¨æ›´æ–°**
   - æƒé™é…ç½®é¡µé¢è‡ªåŠ¨æ˜¾ç¤ºæ–°èœå•
   - ç”¨æˆ·é‡æ–°ç™»å½•åçœ‹åˆ°æ–°åŠŸèƒ½

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

### æƒé™ç»Ÿè®¡
- **æ€»æƒé™æ•°**: 81 ä¸ª
- **èœå•æƒé™**: 20+ ä¸ªï¼ˆçˆ¶çº§ + å­çº§é¡µé¢ï¼‰
- **æ“ä½œæƒé™**: 60+ ä¸ªï¼ˆå¢åˆ æ”¹æŸ¥ç­‰ï¼‰

### ç®¡ç†å‘˜ä½“éªŒ
- âœ… æƒé™æ ‘**å®Œå…¨æ¥è‡ªåç«¯èœå•é…ç½®**
- âœ… å‹¾é€‰/å–æ¶ˆå‹¾é€‰**ç«‹å³ç”Ÿæ•ˆ**
- âœ… æƒé™å‘½åæ¸…æ™°ï¼Œ**è§åçŸ¥ä¹‰**
- âœ… é…ç½®ç®€å•ï¼Œ**åªéœ€å…³æ³¨èœå•æƒé™**

### å¼€å‘äººå‘˜ä½“éªŒ
- âœ… **å•ä¸€é…ç½®æº**ï¼Œä¿®æ”¹èœå•åªéœ€æ”¹ä¸€ä¸ªæ–‡ä»¶
- âœ… **è‡ªåŠ¨åŒæ­¥**ï¼Œå‰ç«¯æ— éœ€æ‰‹åŠ¨ç»´æŠ¤æƒé™æ ‘
- âœ… **å‘½åè§„èŒƒ**ï¼Œé¿å…æƒé™å†²çª
- âœ… **æƒé™ç»§æ‰¿**ï¼Œå‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

---

**å®Œæˆæ—¶é—´**: 2025å¹´11æœˆ28æ—¥  
**ç‰ˆæœ¬**: v4.0 (è§„èŒƒåŒ–æœ€ç»ˆç‰ˆ)

