# æƒé™ç®¡ç†ç³»ç»Ÿå®æ–½æ­¥éª¤

## ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡ âœ…
- åœ¨ `backend/prisma/schema.prisma` ä¸­æ·»åŠ äº† `Permission` å’Œ `RolePermission` è¡¨
- å®šä¹‰äº†æƒé™ä¸è§’è‰²çš„å…³è”å…³ç³»

### 2. æƒé™ç§å­æ•°æ® âœ…
- åˆ›å»º `backend/prisma/seeds/permissions.seed.ts`
- å®šä¹‰äº†91ä¸ªæƒé™ç‚¹ï¼Œè¦†ç›–æ‰€æœ‰æ¨¡å—
- ä¸º5ä¸ªè§’è‰²ï¼ˆADMINã€STAFFã€TEACHERã€ADVISORã€STUDENTï¼‰åˆ†é…äº†åˆç†çš„æƒé™

### 3. åç«¯å®ç° âœ…
- åˆ›å»º `PermissionsModule`ã€`PermissionsService`ã€`PermissionsController`
- åœ¨ `AuthService` ä¸­é›†æˆæƒé™è·å–é€»è¾‘
- ç”¨æˆ·ç™»å½•åè‡ªåŠ¨è¿”å›æƒé™åˆ—è¡¨

### 4. å‰ç«¯å®ç° âœ…
- åˆ›å»º `admin-frontend/src/config/permissions.ts` æƒé™é…ç½®æ–‡ä»¶
- æ›´æ–° `AdminLayout` ç»„ä»¶æ”¯æŒåŸºäºæƒé™çš„èœå•è¿‡æ»¤
- åˆ›å»º `v-permission` æŒ‡ä»¤ç”¨äºé¡µé¢æŒ‰é’®æƒé™æ§åˆ¶
- æ›´æ–° `SidebarItem` ç»„ä»¶é€‚é…æ–°çš„èœå•ç»“æ„

### 5. æ–‡æ¡£ âœ…
- åˆ›å»ºã€Šæƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡.mdã€‹è¯¦ç»†è¯´æ˜æ–‡æ¡£

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œï¼‰

### ç¬¬ä¸€æ­¥ï¼šåœæ­¢åç«¯æœåŠ¡

å¦‚æœåç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œè¯·å…ˆåœæ­¢å®ƒï¼š

```bash
# æŒ‰ Ctrl+C åœæ­¢åç«¯æœåŠ¡
# æˆ–è€…åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­ç»“æŸ node.exe è¿›ç¨‹
```

### ç¬¬äºŒæ­¥ï¼šç”Ÿæˆ Prisma Client

```bash
cd d:\edp-project\backend
npx prisma generate
```

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æƒé™æ•°æ®

æœ‰ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼ä¸€ï¼šåªåˆå§‹åŒ–æƒé™æ•°æ®**
```bash
cd d:\edp-project\backend
npx ts-node prisma/seeds/permissions.seed.ts
```

**æ–¹å¼äºŒï¼šè¿è¡Œå®Œæ•´çš„ç§å­æ•°æ®ï¼ˆåŒ…å«æƒé™å’Œç¤ºä¾‹æ•°æ®ï¼‰**
```bash
cd d:\edp-project\backend
npx prisma db seed
```

### ç¬¬å››æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd d:\edp-project\backend
npm run start:dev
```

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•æƒé™ç³»ç»Ÿ

1. **ç™»å½•æµ‹è¯•**
   - ä½¿ç”¨ä¸åŒè§’è‰²çš„è´¦å·ç™»å½•ç®¡ç†åå°
   - è§‚å¯Ÿä¾§è¾¹æ èœå•æ˜¯å¦æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒå†…å®¹

2. **åˆ›å»ºæµ‹è¯•è´¦å·**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   
   å¯ä»¥åœ¨ç”¨æˆ·ç®¡ç†ä¸­åˆ›å»ºä¸åŒè§’è‰²çš„æµ‹è¯•è´¦å·ï¼š
   
   ```
   è¶…çº§ç®¡ç†å‘˜ï¼ˆADMINï¼‰ï¼šæ‹¥æœ‰æ‰€æœ‰æƒé™
   æ•™åŠ¡äººå‘˜ï¼ˆSTAFFï¼‰ï¼šè´Ÿè´£æ—¥å¸¸è¿è¥
   æ•™å¸ˆï¼ˆTEACHERï¼‰ï¼šç®¡ç†è¯¾ç¨‹å’Œå­¦å‘˜
   è¯¾ç¨‹é¡¾é—®ï¼ˆADVISORï¼‰ï¼šå­¦å‘˜å’¨è¯¢æœåŠ¡
   å­¦å‘˜ï¼ˆSTUDENTï¼‰ï¼šåŸºæœ¬æŸ¥çœ‹æƒé™
   ```

3. **æƒé™æµ‹è¯•æ¸…å•**
   
   - [ ] ADMIN è§’è‰²èƒ½çœ‹åˆ°æ‰€æœ‰èœå•
   - [ ] STAFF è§’è‰²çœ‹ä¸åˆ°"ç³»ç»Ÿè®¾ç½® > è§’è‰²æƒé™"
   - [ ] TEACHER è§’è‰²åªèƒ½çœ‹åˆ°è¯¾ç¨‹ã€ç”¨æˆ·ã€æŠ¥åã€è¯¾ä»¶ã€æ•°æ®ç»Ÿè®¡ç›¸å…³èœå•
   - [ ] ADVISOR è§’è‰²åªèƒ½çœ‹åˆ°èµ„è®¯ã€è¯¾ç¨‹ã€ç”¨æˆ·ã€æŠ¥åã€æ•°æ®ç»Ÿè®¡ç›¸å…³èœå•
   - [ ] STUDENT è§’è‰²åªèƒ½çœ‹åˆ°é¦–é¡µã€èµ„è®¯ã€è¯¾ç¨‹èœå•
   - [ ] é¡µé¢æŒ‰é’®æ ¹æ®æƒé™æ˜¾ç¤º/éšè—ï¼ˆéœ€è¦ç»™æŒ‰é’®æ·»åŠ  v-permission æŒ‡ä»¤ï¼‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœ¨é¡µé¢ä¸­æ§åˆ¶æŒ‰é’®æƒé™

```vue
<template>
  <div>
    <!-- åªæœ‰æ‹¥æœ‰ news:create æƒé™çš„ç”¨æˆ·èƒ½çœ‹åˆ°æ­¤æŒ‰é’® -->
    <el-button v-permission="'news:create'" type="primary" @click="handleCreate">
      åˆ›å»ºèµ„è®¯
    </el-button>
    
    <!-- æ‹¥æœ‰ news:edit æˆ– news:delete ä»»æ„ä¸€ä¸ªæƒé™å°±èƒ½çœ‹åˆ° -->
    <el-button v-permission="['news:edit', 'news:delete']" @click="handleEdit">
      æ“ä½œ
    </el-button>
  </div>
</template>
```

### åœ¨ä»£ç ä¸­æ£€æŸ¥æƒé™

```typescript
import { useAuthStore } from '@/stores/auth'
import { hasPermission, hasAnyPermission } from '@/config/permissions'

const authStore = useAuthStore()
const permissions = authStore.permissions

// æ£€æŸ¥å•ä¸ªæƒé™
if (hasPermission('news:create', permissions)) {
  // æ‰§è¡Œæ“ä½œ
}

// æ£€æŸ¥å¤šä¸ªæƒé™ï¼ˆä»»æ„ä¸€ä¸ªï¼‰
if (hasAnyPermission(['news:create', 'news:edit'], permissions)) {
  // æ‰§è¡Œæ“ä½œ
}
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ç”Ÿæˆ Prisma Client æ—¶æç¤ºæ–‡ä»¶è¢«å ç”¨ï¼Ÿ
**A:** å…ˆåœæ­¢åç«¯æœåŠ¡ï¼ˆCtrl+C æˆ–ä»»åŠ¡ç®¡ç†å™¨ç»“æŸ node.exeï¼‰ï¼Œå†è¿è¡Œ `npx prisma generate`

### Q2: æƒé™æ•°æ®åˆå§‹åŒ–å¤±è´¥ï¼Ÿ
**A:** æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` é…ç½®æ­£ç¡®

### Q3: å‰ç«¯èœå•æ²¡æœ‰æ ¹æ®æƒé™è¿‡æ»¤ï¼Ÿ
**A:** 
1. ç¡®ä¿åç«¯å·²è¿”å›æƒé™åˆ—è¡¨ï¼ˆæŸ¥çœ‹æµè§ˆå™¨ Network ä¸­ `/auth/profile` æ¥å£å“åº”ï¼‰
2. ç¡®ä¿å‰ç«¯å·²æ­£ç¡®è·å–æƒé™ï¼ˆåœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥ `JSON.parse(localStorage.getItem('edp-admin-auth'))`ï¼‰
3. é‡æ–°ç™»å½•ä¸€æ¬¡

### Q4: å¦‚ä½•æ·»åŠ æ–°çš„æƒé™ï¼Ÿ
**A:** 
1. ç¼–è¾‘ `backend/prisma/seeds/permissions.seed.ts`
2. åœ¨ `permissions` æ•°ç»„ä¸­æ·»åŠ æ–°æƒé™
3. åœ¨ `rolePermissions` ä¸­ä¸ºç›¸åº”è§’è‰²åˆ†é…æƒé™
4. è¿è¡Œ `npx ts-node prisma/seeds/permissions.seed.ts`

### Q5: å¦‚ä½•ä¿®æ”¹æŸä¸ªè§’è‰²çš„æƒé™ï¼Ÿ
**A:** 
1. ç¼–è¾‘ `backend/prisma/seeds/permissions.seed.ts`
2. ä¿®æ”¹ `rolePermissions` ä¸­å¯¹åº”è§’è‰²çš„æƒé™åˆ—è¡¨
3. è¿è¡Œ `npx ts-node prisma/seeds/permissions.seed.ts`

## ğŸ“Š æƒé™ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç™»å½•                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AuthService.getProfile(userId)                  â”‚
â”‚         â”œâ”€ è·å–ç”¨æˆ·ä¿¡æ¯                                 â”‚
â”‚         â””â”€ PermissionsService.getRolePermissions(role)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ è¿”å› { user, permissions }
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯ AuthStore å­˜å‚¨                         â”‚
â”‚              â”œâ”€ userInfo                                â”‚
â”‚              â””â”€ permissions: string[]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èœå•è¿‡æ»¤      â”‚ â”‚  æŒ‰é’®æƒé™æ§åˆ¶     â”‚
â”‚ (AdminLayout)   â”‚ â”‚  (v-permission)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **åç«¯APIæƒé™å®ˆå«**
   - åˆ›å»º `PermissionGuard` ç”¨äºä¿æŠ¤APIæ¥å£
   - ä½¿ç”¨è£…é¥°å™¨ `@RequirePermission('news:create')` æ ‡æ³¨éœ€è¦çš„æƒé™

2. **æ•°æ®æƒé™**
   - å®ç°æ•°æ®çº§åˆ«çš„æƒé™æ§åˆ¶
   - ä¾‹å¦‚ï¼šæ•™å¸ˆåªèƒ½æŸ¥çœ‹è‡ªå·±çš„è¯¾ç¨‹ï¼Œé¡¾é—®åªèƒ½æŸ¥çœ‹è‡ªå·±è´Ÿè´£çš„å­¦å‘˜

3. **æƒé™ç®¡ç†ç•Œé¢**
   - åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æ·»åŠ "è§’è‰²æƒé™ç®¡ç†"é¡µé¢
   - å¯è§†åŒ–é…ç½®è§’è‰²æƒé™ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 

4. **æƒé™ç¼“å­˜ä¼˜åŒ–**
   - ä½¿ç”¨ Redis ç¼“å­˜ç”¨æˆ·æƒé™
   - å‡å°‘æ•°æ®åº“æŸ¥è¯¢

5. **æ“ä½œæ—¥å¿—**
   - è®°å½•é‡è¦æ“ä½œçš„æ—¥å¿—
   - å…³è”æ“ä½œäººå’Œæƒé™

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- ã€Šæƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡.mdã€‹- è¯¦ç»†è®¾è®¡æ–‡æ¡£
- `backend/prisma/seeds/permissions.seed.ts` - æƒé™å®šä¹‰
- `admin-frontend/src/config/permissions.ts` - å‰ç«¯æƒé™é…ç½®










