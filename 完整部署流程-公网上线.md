# EDPé¡¹ç›®å®Œæ•´éƒ¨ç½²æµç¨‹ - å…¬ç½‘ä¸Šçº¿

## ğŸ“‹ å‰ææ¡ä»¶

- [x] åŸŸåå·²è§£æï¼š`edp.yunchuangshuan.com` â†’ `106.53.189.87`
- [x] ä»£ç å·²æ¨é€åˆ°GitHub
- [x] æœåŠ¡å™¨å¯ä»¥SSHè®¿é—®

---

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹ï¼ˆ6æ­¥ï¼‰

### æ­¥éª¤1ï¼šç™»å½•æœåŠ¡å™¨

**æ–¹å¼Aï¼šé€šè¿‡å†…ç½‘ç©¿é€ç™»å½•ï¼ˆæ¨èï¼‰**
```bash
ssh -p 3322 ycsa@124.71.105.75
# å¯†ç ï¼šycsa2025
```

**æ–¹å¼Bï¼šç›´æ¥ç”¨å…¬ç½‘IPç™»å½•**
```bash
ssh -p 3322 ycsa@106.53.189.87
# å¯†ç ï¼šycsa2025
```

---

### æ­¥éª¤2ï¼šæ‹‰å–æœ€æ–°ä»£ç 

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/edp-project

# æŸ¥çœ‹å½“å‰åˆ†æ”¯å’ŒçŠ¶æ€
git status
git branch

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# ç¡®è®¤ä»£ç å·²æ›´æ–°
git log -1
```

**é¢„æœŸè¾“å‡ºï¼š**
```
commit 36d3145...
Author: ...
Date: ...

    feat: configure public domain edp.yunchuangshuan.com with HTTPS support
```

---

### æ­¥éª¤3ï¼šåœæ­¢æ‰€æœ‰DockeræœåŠ¡

```bash
cd ~/edp-project/docker-stack

# åœæ­¢æ‰€æœ‰å®¹å™¨
docker-compose down

# ç¡®è®¤å®¹å™¨å·²åœæ­¢
docker ps | grep edp
# åº”è¯¥æ²¡æœ‰è¾“å‡º
```

---

### æ­¥éª¤4ï¼šé‡æ–°æ„å»ºæ‰€æœ‰Dockeré•œåƒ

```bash
# æ¸…ç†æ—§é•œåƒï¼ˆå¯é€‰ï¼‰
docker-compose build --no-cache

# æˆ–åˆ†åˆ«æ„å»ºï¼ˆå¦‚æœåªæ›´æ–°äº†éƒ¨åˆ†æœåŠ¡ï¼‰
# docker-compose build --no-cache backend
# docker-compose build --no-cache frontend
# docker-compose build --no-cache uniapp-h5
```

**é¢„æœŸè¾“å‡ºï¼š**
```
[+] Building ...
 => [backend internal] load build definition
 => [backend internal] load .dockerignore
 => [backend] exporting to image
 ...
 => => naming to docker.io/library/docker-stack-backend
```

---

### æ­¥éª¤5ï¼šå¯åŠ¨æ‰€æœ‰DockeræœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# ç­‰å¾…60ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 60

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

**é¢„æœŸè¾“å‡ºï¼ˆæ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥æ˜¯healthyï¼‰ï¼š**
```
NAME            STATUS                    PORTS
edp-backend     Up (healthy)             0.0.0.0:3000->3000/tcp
edp-frontend    Up (healthy)             0.0.0.0:8080->80/tcp
edp-mysql       Up (healthy)             0.0.0.0:3306->3306/tcp
edp-redis       Up (healthy)             0.0.0.0:6379->6379/tcp
edp-uniapp-h5   Up (healthy)             0.0.0.0:8081->80/tcp
```

---

### æ­¥éª¤6ï¼šéªŒè¯æœåŠ¡

#### 6.1 æœåŠ¡å™¨å†…éƒ¨æµ‹è¯•

```bash
# æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥
curl http://localhost:3000/api/health

# é¢„æœŸè¾“å‡ºï¼š
# {"code":200,"msg":"success","data":{"status":"ok","timestamp":"2025-11-26T..."}}

# æµ‹è¯•å‰ç«¯
curl -I http://localhost:8080/

# é¢„æœŸè¾“å‡ºï¼š
# HTTP/1.1 200 OK

# æµ‹è¯•H5
curl -I http://localhost:8081/

# é¢„æœŸè¾“å‡ºï¼š
# HTTP/1.1 200 OK
```

#### 6.2 æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æˆ–æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker logs edp-backend --tail 50
docker logs edp-frontend --tail 50
docker logs edp-uniapp-h5 --tail 50
```

---

## ğŸŒ é…ç½®å®å¡”Nginxï¼ˆé¦–æ¬¡éƒ¨ç½²å¿…åšï¼‰

### æ­¥éª¤7ï¼šæ·»åŠ ç½‘ç«™

1. ç™»å½•å®å¡”é¢æ¿ï¼š`http://106.53.189.87:8888`
2. ç‚¹å‡» **ç½‘ç«™** â†’ **æ·»åŠ ç«™ç‚¹**
3. å¡«å†™ä¿¡æ¯ï¼š
   - åŸŸåï¼š`edp.yunchuangshuan.com`
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/edp`ï¼ˆéšæ„ï¼Œä¸ä¼šç”¨åˆ°ï¼‰
   - PHPç‰ˆæœ¬ï¼šçº¯é™æ€
   - æ•°æ®åº“ï¼šä¸åˆ›å»º
4. ç‚¹å‡» **æäº¤**

---

### æ­¥éª¤8ï¼šé…ç½®SSLè¯ä¹¦

1. æ‰¾åˆ°åˆšæ·»åŠ çš„ç«™ç‚¹ â†’ ç‚¹å‡» **è®¾ç½®**
2. ç‚¹å‡» **SSL** æ ‡ç­¾
3. é€‰æ‹© **Let's Encrypt**
4. å‹¾é€‰åŸŸåï¼š`edp.yunchuangshuan.com`
5. é‚®ç®±ï¼šå¡«å†™ä½ çš„é‚®ç®±
6. ç‚¹å‡» **ç”³è¯·**
7. ç­‰å¾…è¯ä¹¦ç”³è¯·æˆåŠŸ
8. å¼€å¯ **å¼ºåˆ¶HTTPS**

**éªŒè¯ï¼š**
```bash
# ä»æœ¬åœ°æµ‹è¯•HTTPS
curl https://edp.yunchuangshuan.com/health
```

---

### æ­¥éª¤9ï¼šæ›´æ–°Nginxé…ç½®

1. ç«™ç‚¹è®¾ç½® â†’ **é…ç½®æ–‡ä»¶**
2. **åˆ é™¤æ‰€æœ‰ç°æœ‰å†…å®¹**
3. æ‰“å¼€æœ¬åœ°é¡¹ç›®çš„ `å®å¡”Nginxç”Ÿäº§é…ç½®-HTTPS.conf`
4. **å¤åˆ¶æ‰€æœ‰å†…å®¹**
5. **ç²˜è´´åˆ°é…ç½®æ–‡ä»¶ç¼–è¾‘å™¨**
6. ç‚¹å‡» **ä¿å­˜**

**éªŒè¯é…ç½®ï¼š**
```bash
# SSHåˆ°æœåŠ¡å™¨æ‰§è¡Œ
sudo nginx -t

# é¢„æœŸè¾“å‡ºï¼š
# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

7. é‡å¯Nginxï¼š
```bash
sudo nginx -s reload
```

---

## âœ… æœ€ç»ˆéªŒè¯ï¼ˆæµè§ˆå™¨æµ‹è¯•ï¼‰

### æ­¥éª¤10ï¼šæµè§ˆå™¨è®¿é—®æµ‹è¯•

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹åœ°å€ï¼ˆç”¨ä½ çš„ç”µè„‘ï¼Œä¸æ˜¯æœåŠ¡å™¨ï¼‰ï¼š

| æœåŠ¡ | è®¿é—®åœ°å€ | é¢„æœŸç»“æœ |
|------|---------|---------|
| **ç®¡ç†åå°** | https://edp.yunchuangshuan.com/ | æ˜¾ç¤ºç™»å½•é¡µé¢ï¼Œåœ°å€æ æœ‰ğŸ”’ |
| **APIæ–‡æ¡£** | https://edp.yunchuangshuan.com/api/docs | Swaggeræ–‡æ¡£ |
| **å¥åº·æ£€æŸ¥** | https://edp.yunchuangshuan.com/health | `{"code":200,...}` |
| **H5å°ç¨‹åº** | https://edp.yunchuangshuan.com/h5/ | æ˜¾ç¤ºå°ç¨‹åºé¦–é¡µ |

### æ­¥éª¤11ï¼šåŠŸèƒ½æµ‹è¯•

- [ ] ç®¡ç†åå°ç™»å½•
  - ç”¨æˆ·åï¼š`13800138000`
  - å¯†ç ï¼š`admin123456`
- [ ] æŸ¥çœ‹æ•°æ®çœ‹æ¿
- [ ] æµ‹è¯•æ–°é—»åˆ—è¡¨
- [ ] æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
- [ ] H5å°ç¨‹åºç™»å½•
- [ ] H5æµè§ˆè¯¾ç¨‹

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šåŸŸåæ— æ³•è®¿é—®

**æ£€æŸ¥DNSï¼š**
```bash
# æœ¬åœ°æ‰§è¡Œ
ping edp.yunchuangshuan.com

# åº”è¯¥è¿”å›ï¼š106.53.189.87
```

**æ£€æŸ¥ç«¯å£ï¼š**
```bash
# æœ¬åœ°æ‰§è¡Œ
telnet edp.yunchuangshuan.com 80
telnet edp.yunchuangshuan.com 443
```

---

### é—®é¢˜2ï¼š502 Bad Gateway

**åŸå› ï¼š** Dockerå®¹å™¨æœªå¯åŠ¨æˆ–ä¸å¥åº·

**è§£å†³ï¼š**
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs backend --tail 50

# é‡å¯æœåŠ¡
cd ~/edp-project/docker-stack
docker-compose restart
```

---

### é—®é¢˜3ï¼šSSLè¯ä¹¦é”™è¯¯

**æ£€æŸ¥è¯ä¹¦ï¼š**
```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
sudo ls -la /www/server/panel/vhost/cert/edp.yunchuangshuan.com/

# åº”è¯¥æœ‰ï¼š
# fullchain.pem
# privkey.pem
```

**é‡æ–°ç”³è¯·ï¼š**
1. å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ SSL
2. åˆ é™¤ç°æœ‰è¯ä¹¦
3. é‡æ–°ç”³è¯·Let's Encrypt

---

### é—®é¢˜4ï¼šAPIè·¨åŸŸé”™è¯¯

**æ£€æŸ¥CORSé…ç½®ï¼š**
```bash
# æœåŠ¡å™¨æ‰§è¡Œ
docker logs edp-backend --tail 50 | grep CORS

# æˆ–æŸ¥çœ‹ä»£ç 
cat ~/edp-project/backend/src/main.ts | grep -A 10 "enableCors"
```

**å¦‚æœCORSé…ç½®ä¸å¯¹ï¼Œé‡æ–°æ‹‰ä»£ç ï¼š**
```bash
cd ~/edp-project
git pull origin main
cd docker-stack
docker-compose restart backend
```

---

## ğŸ“Š ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼‰

åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬æ–¹ä¾¿åç»­æ›´æ–°ï¼š

```bash
# åœ¨æœåŠ¡å™¨åˆ›å»ºè„šæœ¬
nano ~/deploy.sh
```

**è„šæœ¬å†…å®¹ï¼š**
```bash
#!/bin/bash

echo "=========================================="
echo "  EDPé¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬"
echo "=========================================="

# è®¾ç½®é¢œè‰²
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/edp-project || exit 1

# æ‹‰å–ä»£ç 
echo -e "${YELLOW}ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ...${NC}"
git pull origin main
if [ $? -ne 0 ]; then
    echo -e "${RED}âŒ ä»£ç æ‹‰å–å¤±è´¥ï¼${NC}"
    exit 1
fi
echo -e "${GREEN}âœ… ä»£ç æ‹‰å–æˆåŠŸ${NC}"

# è¿›å…¥Dockerç›®å½•
cd docker-stack || exit 1

# åœæ­¢æœåŠ¡
echo -e "${YELLOW}ğŸ›‘ åœæ­¢æœåŠ¡...${NC}"
docker-compose down

# é‡æ–°æ„å»º
echo -e "${YELLOW}ğŸ”¨ é‡æ–°æ„å»ºé•œåƒ...${NC}"
docker-compose build --no-cache
if [ $? -ne 0 ]; then
    echo -e "${RED}âŒ æ„å»ºå¤±è´¥ï¼${NC}"
    exit 1
fi
echo -e "${GREEN}âœ… æ„å»ºæˆåŠŸ${NC}"

# å¯åŠ¨æœåŠ¡
echo -e "${YELLOW}ğŸš€ å¯åŠ¨æœåŠ¡...${NC}"
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo -e "${YELLOW}â³ ç­‰å¾…60ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨...${NC}"
sleep 60

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo -e "${YELLOW}ğŸ“Š æ£€æŸ¥æœåŠ¡çŠ¶æ€...${NC}"
docker-compose ps

# æµ‹è¯•å¥åº·æ£€æŸ¥
echo -e "${YELLOW}ğŸ” æµ‹è¯•æœåŠ¡å¥åº·...${NC}"
HEALTH=$(curl -s http://localhost:3000/api/health)
if [[ $HEALTH == *"ok"* ]]; then
    echo -e "${GREEN}âœ… åç«¯æœåŠ¡æ­£å¸¸${NC}"
else
    echo -e "${RED}âŒ åç«¯æœåŠ¡å¼‚å¸¸${NC}"
fi

echo ""
echo -e "${GREEN}=========================================="
echo "  ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "==========================================${NC}"
echo ""
echo "è®¿é—®åœ°å€ï¼š"
echo "  ç®¡ç†åå°: https://edp.yunchuangshuan.com/"
echo "  APIæ–‡æ¡£:  https://edp.yunchuangshuan.com/api/docs"
echo "  H5å°ç¨‹åº: https://edp.yunchuangshuan.com/h5/"
echo ""
```

**ä½¿è„šæœ¬å¯æ‰§è¡Œï¼š**
```bash
chmod +x ~/deploy.sh
```

**ä½¿ç”¨è„šæœ¬ï¼š**
```bash
~/deploy.sh
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] DNSè§£ææ­£ç¡®ï¼ˆpingåŸŸåè¿”å›å…¬ç½‘IPï¼‰
- [ ] é˜²ç«å¢™å¼€æ”¾80ã€443ç«¯å£
- [ ] SSLè¯ä¹¦å·²ç”³è¯·å¹¶å¯ç”¨
- [ ] Nginxé…ç½®å·²æ›´æ–°
- [ ] æ‰€æœ‰Dockerå®¹å™¨éƒ½æ˜¯healthyçŠ¶æ€
- [ ] åç«¯å¥åº·æ£€æŸ¥è¿”å›200
- [ ] ç®¡ç†åå°å¯ä»¥è®¿é—®å¹¶ç™»å½•
- [ ] APIæ–‡æ¡£å¯ä»¥è®¿é—®
- [ ] H5å°ç¨‹åºå¯ä»¥è®¿é—®
- [ ] å›¾ç‰‡å¯ä»¥æ­£å¸¸åŠ è½½
- [ ] HTTPSæœ‰æ•ˆï¼ˆæµè§ˆå™¨æ˜¾ç¤ºğŸ”’ï¼‰

---

## ğŸ”„ åç»­æ›´æ–°æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

å½“æœ‰ä»£ç æ›´æ–°æ—¶ï¼Œåªéœ€è¦ï¼š

```bash
# SSHç™»å½•
ssh -p 3322 ycsa@106.53.189.87

# æ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
~/deploy.sh
```

æˆ–æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
cd ~/edp-project && \
git pull origin main && \
cd docker-stack && \
docker-compose down && \
docker-compose build --no-cache && \
docker-compose up -d
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚é‡åˆ°é—®é¢˜ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **é”™è¯¯æˆªå›¾**
2. **Dockeræ—¥å¿—**ï¼š
   ```bash
   docker-compose logs --tail 100
   ```
3. **Nginxé”™è¯¯æ—¥å¿—**ï¼š
   ```bash
   tail -100 /www/wwwlogs/edp-error.log
   ```
4. **æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯**

---

**ç°åœ¨å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¥éª¤1äº†ï¼** ğŸš€


